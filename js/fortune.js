/*
  fortune.js / Version 1.3
  ------------------------------------------------------------
  âœ… å…¬é–‹å‘ã‘ï¼šå°‚é–€ç”¨èªã‚¼ãƒ­ï¼ˆå®Œå…¨ã«ç¿»è¨³ï¼‰
  âœ… å£èª¿ï¼šå¥³ã®å­ã®è©±ã—è¨€è‘‰
     - softï¼šãµã‚ãµã‚å¤©ä½¿ï¼ˆåŒ…ã¿è¾¼ã‚€/ã‚„ã•ã—ã„/èªå°¾ã€Œã€œã ã‚ˆã€ã€Œã€œã ã‚ˆã­ã€œã€ï¼‰
     - normalï¼šå‹é”ã«è©±ã™æ„Ÿã˜
     - spicyï¼šæ¯’èˆŒãªå¥³ã®å­ï¼ˆã€Œã‚„ã‚Œã€ç¦æ­¢ â†’ ã€Œã‚„ã£ã¦ã€ã€Œã€œã—ãªï¼Ÿã€ï¼‰
  âœ… ä»Šæ—¥ã®ã²ã¨ã“ã¨ï¼šãƒ©ãƒ³ãƒ€ãƒ ã§ã¯ãªãæ ¹æ‹ ã§æ±ºã‚ã‚‹ï¼ˆä»Šæ—¥ã®ç©ºæ°— Ã— ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ï¼‰
  âœ… è£ãƒ¡ãƒ¢ï¼šå°‚é–€ç”¨èªã‚ã‚Šï¼ˆæŠ˜ã‚ŠãŸãŸã¿ç”¨ï¼‰
*/

import { aspectBetween } from "./astro.js";

/* =========
  åˆå¿ƒè€…å‘ã‘ï¼šã“ã“ãŒæ–‡ç« DBï¼ˆåŸºæœ¬ã“ã“ã ã‘è§¦ã‚Œã°OKï¼‰
========= */
export const TEXT_DB = {
  tone: {
    soft: {
      header: "ã†ã‚“ã†ã‚“ã€ã¡ã‚ƒã‚“ã¨è¦‹ãŸã‚ˆã€‚å¤§ä¸ˆå¤«ã ã‚ˆã€‚ä»Šæ—¥ã¯ã­ã€ã‚ãªãŸãŒå®‰å¿ƒã§ãã‚‹å½¢ã«æ•´ãˆã¦ã‚ã’ã‚‹ã­ã€œã€‚",
      closer: "ã§ãã¦ã‚‹ã¨ã“ã‚ã€ã¡ã‚ƒã‚“ã¨ã‚ã‚‹ã‚ˆã€‚ã ã‹ã‚‰ç„¦ã‚‰ãªãã¦ã„ã„ã®ã€‚ä»Šæ—¥ã®åˆ†ã ã‘ã€ã„ã£ã—ã‚‡ã«é€²ã‚‚ï¼Ÿ",
    },
    normal: {
      header: "ã‚ˆã—ã€å‚¾å‘ã¾ã¨ã‚ã‚‹ã­ã€‚ä»Šæ—¥ã®å‹•ãæ–¹ã¾ã§ã€ã¡ã‚ƒã‚“ã¨è½ã¨ã—ã¦ã„ãã‚ˆã€‚",
      closer: "é‹ã£ã¦ã­ã€é¸ã³æ–¹ã¨ç¶šã‘æ–¹ã§ã¡ã‚ƒã‚“ã¨å¤‰ã‚ã‚‹ã€‚ã ã‹ã‚‰å¤§ä¸ˆå¤«ã€‚",
    },
    spicy: {
      header: "ã¯ã„è¦‹ãŸã€‚ç”˜ã‚„ã‹ã•ãªã„ã‚ˆï¼Ÿä¼¸ã³ãŸã„ãªã‚‰ã€ã¡ã‚ƒã‚“ã¨ç¾å®Ÿè¦‹ã‚ˆã€œã€‚",
      closer: "åˆºã•ã£ãŸï¼Ÿãªã‚‰æ­£è§£ã€‚ãã“ç›´ã—ãŸã‚‰ã€ã‚ãªãŸã‚‚ã£ã¨å¼·ããªã‚‹ã‚ˆã€‚",
    }
  },

  /* è¡¨å‘ã‘ãƒ©ãƒ™ãƒ«ï¼ˆå°‚é–€ç”¨èªã¯å‡ºã•ãªã„ï¼‰ */
  faceLabel: {
    "ç‰¡ç¾Šåº§":"ã¾ã£ã™ãçªæ’ƒã‚¿ã‚¤ãƒ—","ç‰¡ç‰›åº§":"ã˜ã£ãã‚Šå®‰å®šã‚¿ã‚¤ãƒ—","åŒå­åº§":"è»½ã‚„ã‹åˆ‡ã‚Šæ›¿ãˆã‚¿ã‚¤ãƒ—","èŸ¹åº§":"å®ˆã£ã¦è‚²ã¦ã‚‹ã‚¿ã‚¤ãƒ—",
    "ç…å­åº§":"å ‚ã€…ã‚»ãƒ³ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—","ä¹™å¥³åº§":"æ•´ãˆã¦å¼·ããªã‚‹ã‚¿ã‚¤ãƒ—","å¤©ç§¤åº§":"ãƒãƒ©ãƒ³ã‚¹ç¾æ„è­˜ã‚¿ã‚¤ãƒ—","è åº§":"æ·±ãåˆºã•ã‚‹ã‚¿ã‚¤ãƒ—",
    "å°„æ‰‹åº§":"åºƒã’ã¦ä¼¸ã³ã‚‹ã‚¿ã‚¤ãƒ—","å±±ç¾Šåº§":"ç©ã¿ä¸Šã’è·äººã‚¿ã‚¤ãƒ—","æ°´ç“¶åº§":"è‡ªç”±ç™ºæƒ³ã‚¿ã‚¤ãƒ—","é­šåº§":"ã‚„ã•ã—ã„æ„Ÿæ€§ã‚¿ã‚¤ãƒ—"
  },
  coreLabel: {
    "ç‰¡ç¾Šåº§":"å³åå¿œã§ç‡ƒãˆã‚‹","ç‰¡ç‰›åº§":"å®‰å¿ƒç¬¬ä¸€ã§å›ºã„","åŒå­åº§":"é ­ãŒå…ˆã«å‹•ã","èŸ¹åº§":"æ°—æŒã¡ã§æ±ºã‚ã‚‹",
    "ç…å­åº§":"ãƒ—ãƒ©ã‚¤ãƒ‰ã§å‹•ã","ä¹™å¥³åº§":"æ°—ã¥ã„ã¦ç›´ã™","å¤©ç§¤åº§":"ç©ºæ°—ã‚’èª­ã‚€","è åº§":"ä¸€å›æ±ºã‚ãŸã‚‰æ·±ã„",
    "å°„æ‰‹åº§":"é¢ç™½ã•å„ªå…ˆ","å±±ç¾Šåº§":"ç¾å®Ÿã§åˆ¤æ–­","æ°´ç“¶åº§":"è‡ªåˆ†ãƒ«ãƒ¼ãƒ«","é­šåº§":"å…±æ„Ÿã§å‹•ã"
  },
  numLabel: {
    1:"ã¯ã˜ã‚ã‚‹åŠ›",2:"åˆã‚ã›ã‚‹åŠ›",3:"åºƒã’ã‚‹åŠ›",4:"ç©ã‚€åŠ›",5:"å¤‰ãˆã‚‹åŠ›",6:"å®ˆã‚‹åŠ›",7:"èª­ã¿è§£ãåŠ›",8:"å‹ã¡åˆ‡ã‚‹åŠ›",9:"ã¾ã¨ã‚ã‚‹åŠ›"
  },

  /* 20ã‚¿ã‚¤ãƒ—ï¼ˆã‹ã‚ã„ã„ï¼‰ */
  types20: {
    "FIRE_1":  { name:"ã»ã‹ã»ã‹è¦‹å®ˆã‚Šã‚°ãƒ", desc:"å®‰å¿ƒã§ãã‚‹åœŸå°ãŒã§ããŸç¬é–“ã€ã‚ãªãŸã®é‹ã¯ä¸€æ°—ã«ä¼¸ã³ã‚‹ã‚ˆã€‚", tags:"ç«Ã—å®‰å®š" },
    "FIRE_2":  { name:"ãƒ¡ãƒ©ãƒ¡ãƒ©ç·´ç¿’ã‚°ãƒ",   desc:"åå¾©ãŒæ‰èƒ½ã€‚åœ°å‘³ã«è¦‹ãˆã¦ã€ã„ã¡ã°ã‚“å¼·ã„è‚²ã¡æ–¹ã ã‚ˆã€‚", tags:"ç«Ã—æˆé•·" },
    "FIRE_3":  { name:"ãƒ‰ãƒƒã‚«ãƒ³çªæ’ƒã‚°ãƒ",   desc:"æ±ºã‚ã¦å‹•ã„ãŸç¬é–“ãŒæœ€å¼·ã€‚è¿·ã„ã§æ­¢ã¾ã‚‹ã®ã ã‘æã ã‚ˆã€‚", tags:"ç«Ã—æŒ‘æˆ¦" },
    "FIRE_4":  { name:"ã²ã‚‰ã‚ãå†’é™ºã‚°ãƒ",   desc:"é¢ç™½ã„æ–¹ã«è¡Œãã»ã©é‹ãŒé–‹ãã€‚ä½“é¨“ãŒæ­£è§£ã«ãªã‚‹ã‚¿ã‚¤ãƒ—ã ã‚ˆã€‚", tags:"ç«Ã—æ¢ç©¶" },
    "FIRE_5":  { name:"ã”ã»ã†ã³é”æˆã‚°ãƒ",   desc:"æœ€å¾Œã«å‹ã¤ã€‚ã‚„ã‚ãªã„é™ã‚Šè² ã‘ãªã„ã‚¿ã‚¤ãƒ—ã ã‚ˆã€‚", tags:"ç«Ã—å®Œæˆ" },

    "EARTH_1": { name:"ã‚‚ãµã‚‚ãµåŸºç¤ã‚°ãƒ",   desc:"æ•´ãˆãŸåˆ†ã ã‘å®‰å®šã™ã‚‹ã€‚ç”Ÿæ´»ã®åœŸå°ãŒãã®ã¾ã¾æ­¦å™¨ã ã‚ˆã€‚", tags:"åœ°Ã—å®‰å®š" },
    "EARTH_2": { name:"ã‚³ãƒ„ã‚³ãƒ„è·äººã‚°ãƒ",   desc:"ç©ã¿ä¸Šã’ãŒè£åˆ‡ã‚‰ãªã„ã€‚æ°—ã¥ã„ãŸã‚‰å‘¨ã‚ŠãŒè¿½ã„ã¤ã‘ãªã„ã‚ˆã€‚", tags:"åœ°Ã—æˆé•·" },
    "EARTH_3": { name:"ç¾å®Ÿã¤ã‚ˆã¤ã‚ˆã‚°ãƒ",   desc:"å‹ã¡ç­‹ã‚’ä½œã£ã¦ã‹ã‚‰æ”»ã‚ã‚‹ã€‚é‹ã‚’ä»•çµ„ã¿ã«ã§ãã‚‹ã‚ˆã€‚", tags:"åœ°Ã—æŒ‘æˆ¦" },
    "EARTH_4": { name:"é»™ã€…ç ”ç©¶ã‚°ãƒ",       desc:"æ·±æ˜ã‚Šã™ã‚‹ã»ã©è©•ä¾¡ãŒä¸ŠãŒã‚‹ã€‚é™ã‹ã«å¼·ã„ã®ãŒé­…åŠ›ã ã‚ˆã€‚", tags:"åœ°Ã—æ¢ç©¶" },
    "EARTH_5": { name:"æ•´ãˆå®Œäº†ã‚°ãƒ",       desc:"åŒºåˆ‡ã£ã¦æ¬¡ã¸è¡Œã‘ã‚‹ã€‚ç‰‡ã¥ã‘ã‚‹ã»ã©é‹ãŒå…¥ã£ã¦ãã‚‹ã‚ˆã€‚", tags:"åœ°Ã—å®Œæˆ" },

    "AIR_1":   { name:"ãµã‚ã£ã¨èª¿æ•´ã‚°ãƒ",   desc:"ç©ºæ°—ã‚’æ•´ãˆã‚‹ã¨ä¸€æ°—ã«ãƒ©ã‚¯ã«ãªã‚‹ã€‚ç„¡ç†ã—ãªã„ã®ã«å¼·ã„ã‚ˆã€‚", tags:"é¢¨Ã—å®‰å®š" },
    "AIR_2":   { name:"ãŠã—ã‚ƒã¹ã‚Šæˆé•·ã‚°ãƒ", desc:"è¨€è‘‰ã¨æƒ…å ±ã§ä¼¸ã³ã‚‹ã€‚ç™ºä¿¡ã¯é‹ã®ã‚¹ã‚¤ãƒƒãƒã ã‚ˆã€‚", tags:"é¢¨Ã—æˆé•·" },
    "AIR_3":   { name:"ã‚¹ãƒ”ãƒ¼ãƒ‰è»¢èº«ã‚°ãƒ",   desc:"åˆ‡ã‚Šæ›¿ãˆãŒæ—©ã„ã€‚å‹•ã„ãŸå›æ•°ãŒæœªæ¥ã‚’ä½œã‚‹ã‚ˆã€‚", tags:"é¢¨Ã—æŒ‘æˆ¦" },
    "AIR_4":   { name:"ã‚¢ã‚¤ãƒ‡ã‚¢é£›è¡Œã‚°ãƒ",   desc:"ã²ã‚‰ã‚ãã‚’æ‹¾ã£ã¦å½¢ã«ã§ããŸã‚‰æœ€å¼·ã€‚æ€ã„ã¤ãã§çµ‚ã‚ã‚‰ã›ãªã„ã§ã­ã€‚", tags:"é¢¨Ã—æ¢ç©¶" },
    "AIR_5":   { name:"è¨€èªåŒ–ã¾ã¨ã‚ã‚°ãƒ",   desc:"æ•´ç†ã—ãŸç¬é–“ã«å‹ã¤ã€‚è¨€è‘‰ã«ã§ããŸã‚‰ç¾å®ŸãŒã¤ã„ã¦ãã‚‹ã‚ˆã€‚", tags:"é¢¨Ã—å®Œæˆ" },

    "WATER_1": { name:"ã—ã£ã¨ã‚Šå®‰å¿ƒã‚°ãƒ",   desc:"å±…å ´æ‰€ãŒã§ãã‚‹ã¨é‹ãŒå¼·ã„ã€‚ç¸ãŒã‚ãªãŸã®åœŸå°ã«ãªã‚‹ã‚ˆã€‚", tags:"æ°´Ã—å®‰å®š" },
    "WATER_2": { name:"ã˜ã‚ã˜ã‚è‚²æˆã‚°ãƒ",   desc:"è‚²ã¦ãŸã‚‚ã®ãŒè²¡ç”£ã€‚ã˜ã‚ã˜ã‚å¼·ã„ã®ãŒæœ¬ç‰©ã ã‚ˆã€‚", tags:"æ°´Ã—æˆé•·" },
    "WATER_3": { name:"è¦šæ‚Ÿã‚¬ãƒæ‹ã‚°ãƒ",     desc:"æœ¬æ°—ã‚’æ±ºã‚ãŸã‚‰å¼·ã„ã€‚è¦šæ‚ŸãŒæµã‚Œã‚’å‹•ã‹ã™ã‚ˆã€‚", tags:"æ°´Ã—æŒ‘æˆ¦" },
    "WATER_4": { name:"æ·±æµ·èª­ã¿è§£ãã‚°ãƒ",   desc:"æœ¬è³ªã‚’è¦‹æŠœãã€‚æ·±ãèª­ã‚“ã åˆ†ã ã‘ç­”ãˆãŒå‡ºã‚‹ã‚ˆã€‚", tags:"æ°´Ã—æ¢ç©¶" },
    "WATER_5": { name:"æµ„åŒ–ãƒªã‚»ãƒƒãƒˆã‚°ãƒ",   desc:"æ‰‹æ”¾ã—ãŒé–‹é‹ã€‚åŒºåˆ‡ã‚‹ã»ã©ã€æ¬¡ãŒå…¥ã£ã¦ãã‚‹ã‚ˆã€‚", tags:"æ°´Ã—å®Œæˆ" },
  },
};

/* =========
  æ•°ç§˜ï¼ˆ1ã€œ9ï¼‰
========= */
export function lifePath(dobStr){
  const s = dobStr.replaceAll("-", "");
  let sum = 0;
  for (const ch of s) sum += Number(ch);
  while (sum > 9) sum = String(sum).split("").reduce((a,c)=>a+Number(c),0);
  return sum || 9;
}

/* =========
  å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¡¨ã«ã¯å‡ºã•ãªã„ï¼‰
========= */
export function signElement(sign){
  const fire  = ["ç‰¡ç¾Šåº§","ç…å­åº§","å°„æ‰‹åº§"];
  const earth = ["ç‰¡ç‰›åº§","ä¹™å¥³åº§","å±±ç¾Šåº§"];
  const air   = ["åŒå­åº§","å¤©ç§¤åº§","æ°´ç“¶åº§"];
  if (fire.includes(sign)) return "FIRE";
  if (earth.includes(sign)) return "EARTH";
  if (air.includes(sign)) return "AIR";
  return "WATER";
}
function lpBucket(lp){
  if (lp === 9) return 5;
  if (lp === 7 || lp === 8) return 4;
  if (lp === 5 || lp === 6) return 3;
  if (lp === 3 || lp === 4) return 2;
  return 1;
}
export function typeKeyFrom(sunSign, lp){
  return `${signElement(sunSign)}_${lpBucket(lp)}`;
}

/* =========
  ä»Šæ—¥ã®ã²ã¨ã“ã¨ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã§ã¯ãªãæ ¹æ‹ ã§æ±ºã‚ã‚‹ï¼‰
  ãƒ»ä»Šæ—¥ã®æœˆï¼ˆç©ºæ°—ï¼‰ã¨ã€ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ï¼ˆtypeKeyã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ/æ®µéšï¼‰ã§åˆ†å²
  ãƒ»å€™è£œã‹ã‚‰1ã¤é¸ã¶ã¨ãã¯ã€æ¯æ—¥åŒã˜å…¥åŠ›ãªã‚‰åŒã˜çµæœã«ãªã‚‹ï¼ˆç–‘ä¼¼ãƒãƒƒã‚·ãƒ¥ï¼‰
========= */
function hash01(str){
  // 0ã€œ1ã®ç–‘ä¼¼ä¹±æ•°ï¼ˆåŒã˜æ–‡å­—åˆ—ãªã‚‰åŒã˜çµæœï¼‰
  let h = 2166136261;
  for (let i=0; i<str.length; i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  // 0..1
  return ((h >>> 0) % 10000) / 10000;
}

function todayKeyFrom(ctx){
  // ä»Šæ—¥ã®â€œç©ºæ°—â€ã¯ todaySigns.moon ã‚’ä¸»è»¸ã«ã™ã‚‹ï¼ˆä½“æ„Ÿã«ç›´çµã—ã‚„ã™ã„ï¼‰
  const todayMood = signElement(ctx.todaySigns.moon);
  const yourBase  = ctx.typeKey.split("_")[0];  // FIRE/EARTH/AIR/WATER
  const yourStep  = ctx.typeKey.split("_")[1];  // 1..5
  return `${todayMood}_${yourBase}_${yourStep}`;
}

function todayLinePool(toneKey, key){
  // toneKeyã”ã¨ã«åŒã˜æ ¹æ‹ ã§ã‚‚è¨€ã„æ–¹ã‚’å¤‰ãˆã‚‹ï¼ˆã“ã“ãŒâ€œã‚¬ãƒæ„ŸÃ—èª­ã¿ã‚„ã™ã•â€ï¼‰
  // å°‚é–€ç”¨èªã‚¼ãƒ­ã€‚è¨€ã„æ›ãˆã ã‘ã€‚
  const soft = {
    "FIRE_FIRE": [
      "ä»Šæ—¥ã¯ã­ã€å‹¢ã„ãŒå‘³æ–¹ã ã‚ˆã€‚å°ã•ãã§ã„ã„ã‹ã‚‰ã€æœ€åˆã®ä¸€æ­©ã ã‘è¸ã¿å‡ºã—ã¦ã¿ã‚ˆï¼Ÿ",
      "ã‚„ã‚‹æ°—ãŒå‡ºãŸã‚‰å‹ã¡â€¦ã˜ã‚ƒãªãã¦ã€å‹•ã„ãŸã‚‰ã‚„ã‚‹æ°—ãŒã¤ã„ã¦ãã‚‹æ—¥ã ã‚ˆã€œã€‚",
      "è¿·ã†ãªã‚‰ã€ã„ã¡ã°ã‚“å°ã•ã„ã‚„ã¤ã‹ã‚‰å§‹ã‚ã¦ã¿ã¦ã€‚ã™ãæ³¢ã«ä¹—ã‚Œã‚‹ã‚ˆã€‚"
    ],
    "FIRE_EARTH": [
      "ä»Šæ—¥ã¯å‹¢ã„ã‚ˆã‚ŠåœŸå°ã ã‚ˆã€‚æœºã®ä¸Šã¨ã‹äºˆå®šã‚’ã¡ã‚‡ã£ã¨æ•´ãˆã‚‹ã ã‘ã§ã€å¿ƒãŒè»½ããªã‚‹ã‚ˆã€œã€‚",
      "ç„¦ã‚‰ãªãã¦ã„ã„ã®ã€‚ã²ã¨ã¤æ•´ãˆãŸã‚‰ã€è‡ªç„¶ã«æ¬¡ã‚‚å‹•ãã‚„ã™ããªã‚‹æ—¥ã ã‚ˆã€‚",
      "ã¾ãšã¯â€œã‚„ã‚‹ã“ã¨ã‚’æ¸›ã‚‰ã™â€ã®ãŒæ­£è§£ã€‚æ¸›ã‚‰ã›ãŸã‚‰ã€å‹ã¡ã ã‚ˆã€‚"
    ],
    "FIRE_AIR": [
      "ä»Šæ—¥ã¯ã­ã€è¨€è‘‰ã«ã™ã‚‹ã¨é€²ã‚€æ—¥ã ã‚ˆã€‚ãƒ¡ãƒ¢ã«ä¸€è¡Œæ›¸ãã ã‘ã§ã‚‚å¤‰ã‚ã‚‹ã‚ˆã€œã€‚",
      "èª°ã‹ã«ä¸€è¨€é€ã‚‹ã ã‘ã§æµã‚ŒãŒå‹•ãã‚„ã™ã„ã‚ˆã€‚è»½ãã§ã„ã„ã‹ã‚‰ã­ã€‚",
      "é ­ã®ä¸­ã‚’å¤–ã«å‡ºã™æ—¥ã€‚æ›¸ã„ã¦ã€è¦‹ã¦ã€æ•´ãˆã¦ã„ã“ï¼Ÿ"
    ],
    "FIRE_WATER": [
      "ä»Šæ—¥ã¯æ°—æŒã¡ã®ç«åŠ æ¸›ãŒå¤§äº‹ã ã‚ˆã€‚ã„ã£ãŸã‚“è½ã¡ç€ãã¨ã€ã¡ã‚ƒã‚“ã¨å¼·ããªã‚Œã‚‹ã‚ˆã€œã€‚",
      "ç„¡ç†ã«å…ƒæ°—å‡ºã•ãªãã¦ã„ã„ã€‚å®‰å¿ƒã§ãã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ãŸã‚‰ã€ã†ã¾ãã„ãæ—¥ã ã‚ˆã€‚",
      "å¿ƒãŒã»ã£ã¨ã™ã‚‹é¸æŠã‚’ã—ã¦ã­ã€‚ãã“ã‹ã‚‰é‹ãŒè‚²ã¤ã‚ˆã€‚"
    ],

    "EARTH_FIRE": [
      "ä»Šæ—¥ã¯ã­ã€ã‚„ã‚‹ãªã‚‰ä¸€æ°—ã«é€²ã‚€æ—¥ã ã‚ˆã€‚å°ã•ãæ±ºã‚ã¦ã€ãˆã„ã£ã¨ã‚„ã£ã¦ã¿ã‚ˆï¼Ÿ",
      "æ•´ãˆãŸä¸Šã§å‹•ãã¨å¼·ã„æ—¥ã€‚æº–å‚™â†’å®Ÿè¡Œã®é †ãŒã„ã¡ã°ã‚“æ°—æŒã¡ã„ã„ã‚ˆã€œã€‚",
      "è¿·ã£ãŸã‚‰â€œä»Šã™ãã§ãã‚‹æ–¹â€ã€‚ãã‚ŒãŒæ­£è§£ã«ãªã‚Šã‚„ã™ã„ã‚ˆã€‚"
    ],
    "EARTH_EARTH": [
      "ä»Šæ—¥ã¯â€œæ•´ãˆã‚‹ã ã‘ã§å‹ã¡â€ã®æ—¥ã ã‚ˆã€‚ç‰‡ã¥ã‘ã¨ã‹ã€äºˆå®šã®æ•´ç†ã¨ã‹ã­ã€œã€‚",
      "å°ã•ãªç©ã¿ä¸Šã’ãŒã€ã¡ã‚ƒã‚“ã¨æœªæ¥ã«ã¤ãªãŒã‚‹æ—¥ã€‚ãˆã‚‰ã„ã‚ˆã€ã»ã‚“ã¨ã«ã€‚",
      "ä¸€å€‹ã ã‘æ•´ãˆã¦ã¿ã¦ã€‚ãã“ã‹ã‚‰ä¸æ€è­°ã¨å›ã‚Šå‡ºã™ã‚ˆã€‚"
    ],
    "EARTH_AIR": [
      "ä»Šæ—¥ã¯ã­ã€æ•´ç†ã—ã¦è¨€èªåŒ–ã™ã‚‹ã¨é€²ã‚€ã‚ˆã€‚ã‚„ã‚‹ã“ã¨ã‚’3ã¤ã«çµã£ã¦ã¿ã‚ˆï¼Ÿ",
      "é€£çµ¡ã¯çŸ­ãã¦OKã€‚æºœã‚ãªã„ã ã‘ã§é‹ãŒè»½ããªã‚‹æ—¥ã ã‚ˆã€œã€‚",
      "é ­ã®ä¸­ã‚’æ£šãŠã‚ã—ã—ã¦ã€ã‚¹ãƒƒã‚­ãƒªã•ã›ã‚ˆï¼Ÿ"
    ],
    "EARTH_WATER": [
      "ä»Šæ—¥ã¯å®‰å¿ƒã§ãã‚‹å ´æ‰€ãŒå¤§äº‹ã ã‚ˆã€‚è½ã¡ç€ãç©ºé–“ã§ä½œæ¥­ã™ã‚‹ã¨é€²ã¿ã‚„ã™ã„ã‚ˆã€œã€‚",
      "æ°—æŒã¡ãŒæ•´ã†ã¨ã€ä½œæ¥­ã‚‚æ•´ã†æ—¥ã€‚ã¾ãšã¯æ·±å‘¼å¸ã­ã€‚",
      "ã‚„ã•ã—ãè‡ªåˆ†ã‚’æ‰±ã£ã¦ã‚ã’ã¦ã€‚ãã“ãŒã„ã¡ã°ã‚“ã®é–‹é‹ã ã‚ˆã€‚"
    ],

    "AIR_FIRE": [
      "ä»Šæ—¥ã¯ã­ã€ã²ã‚‰ã‚ããŒå¼·ã„ã‚ˆã€‚æ€ã„ã¤ã„ãŸã‚‰ãƒ¡ãƒ¢ã—ã¦ã€ã™ãå°ã•ãè©¦ã—ã¦ã¿ã‚ˆï¼Ÿ",
      "å‹¢ã„ã«ä¹—ã‚Œã‚‹æ—¥ã€‚è¨€ã„è¨³ã¯ç½®ã„ã¨ã„ã¦ã€ã¾ãšä¸€å›ã ã‘å‹•ã„ã¦ã¿ã¦ã€œã€‚",
      "æ–°ã—ã„ã“ã¨ã«ã¡ã‚‡ã„è§¦ã‚Œã™ã‚‹ã ã‘ã§ã€é‹ãŒãƒ‘ãƒƒã¨æ˜ã‚‹ããªã‚‹ã‚ˆã€‚"
    ],
    "AIR_EARTH": [
      "ä»Šæ—¥ã¯ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å½¢ã«ã™ã‚‹ã¨å¼·ã„ã‚ˆã€‚æœ€åˆã®å½¢ã¯é›‘ã§ã„ã„ã‚“ã ã‚ˆã€œã€‚",
      "è€ƒãˆã‚‹ã ã‘ã‚ˆã‚Šã€ã¾ãšå‡ºã—ã¦ã€ã‚ã¨ã§æ•´ãˆã‚ˆï¼Ÿãã‚ŒãŒå‹ã¡ã‚„ã™ã„æ—¥ã€‚",
      "ä¸€å€‹ã ã‘â€œå½¢â€ã«ã—ã¦ã¿ã¦ã€‚ãã“ã‹ã‚‰ç¾å®ŸãŒã¤ã„ã¦ãã‚‹ã‚ˆã€‚"
    ],
    "AIR_AIR": [
      "ä»Šæ—¥ã¯è¨€è‘‰ã®é­”æ³•ãŒåŠ¹ãæ—¥ã ã‚ˆã€‚æ›¸ããƒ»è©±ã™ãƒ»é€ã‚‹ã€ãŒé–‹é‹ã ã‚ˆã€œã€‚",
      "èª°ã‹ã¨ã®ä¼šè©±ã§ãƒ’ãƒ³ãƒˆãŒå‡ºã‚„ã™ã„æ—¥ã€‚è»½ãè©±ã—ã¦ã¿ã‚ˆï¼Ÿ",
      "æƒ…å ±ã‚’å›ã™ã»ã©é‹ãŒå‹•ãæ—¥ã€‚æŠ±ãˆè¾¼ã¾ãªã„ã§ã­ã€‚"
    ],
    "AIR_WATER": [
      "ä»Šæ—¥ã¯ã­ã€æ°—æŒã¡ã®æ•´ç†ãŒå…ˆã ã‚ˆã€‚å¿ƒãŒè½ã¡ç€ãã¨ã€è‡ªç„¶ã«é€²ã‚€ã‚ˆã€œã€‚",
      "å„ªã—ã„è¨€è‘‰ã‚’è‡ªåˆ†ã«ã‹ã‘ã¦ã‚ã’ã¦ã€‚ãã“ã‹ã‚‰å¼·ããªã‚Œã‚‹æ—¥ã€‚",
      "ç„¡ç†ã«æ˜ã‚‹ãã—ãªãã¦ã„ã„ã€‚è½ã¡ç€ã„ãŸé¸æŠãŒæ­£è§£ã«ãªã‚Šã‚„ã™ã„ã‚ˆã€‚"
    ],

    "WATER_FIRE": [
      "ä»Šæ—¥ã¯æ°—æŒã¡ãŒå‹•ãã‚„ã™ã„æ—¥ã ã‚ˆã€‚ã ã‹ã‚‰ã“ãã€ã²ã¨ã¤ã ã‘æ±ºã‚ã¦ã¿ã‚ˆï¼Ÿ",
      "è¿·ã„ãŒå‡ºã¦ã‚‚å¤§ä¸ˆå¤«ã€‚å°ã•ãæ±ºã‚ãŸã‚‰ã€ã¡ã‚ƒã‚“ã¨é€²ã‚€æ—¥ã ã‚ˆã€œã€‚",
      "å‹¢ã„ã‚’å€Ÿã‚Šã¦ã€çŸ­æ™‚é–“ã ã‘é›†ä¸­ã—ã¦ã¿ã¦ã€‚æ„å¤–ã¨ã„ã‘ã‚‹ã‚ˆã€‚"
    ],
    "WATER_EARTH": [
      "ä»Šæ—¥ã¯ã­ã€å®‰å¿ƒãŒé–‹é‹ã ã‚ˆã€‚æ•´ãˆã‚‹ãƒ»ä¼‘ã‚€ãƒ»ã‚ãŸãŸã‚ã‚‹ã€ã“ã‚ŒãŒæ­£è§£ã€œã€‚",
      "ä¸å¯§ã«ã‚„ã‚‹ã»ã©å‹ã¦ã‚‹æ—¥ã€‚æ€¥ãŒãªãã¦ã„ã„ã‚ˆã€‚",
      "ç”Ÿæ´»ã®åœŸå°ã‚’ã¡ã‚‡ã£ã¨æ•´ãˆãŸã‚‰ã€é‹ãŒå®ˆã£ã¦ãã‚Œã‚‹æ—¥ã ã‚ˆã€‚"
    ],
    "WATER_AIR": [
      "ä»Šæ—¥ã¯è©±ã™ã¨æ¥½ã«ãªã‚‹æ—¥ã ã‚ˆã€‚è¨€è‘‰ã«ã—ãŸã‚‰ã€å¿ƒãŒã»ã©ã‘ã‚‹ã‚ˆã€œã€‚",
      "é€£çµ¡ã¯çŸ­ãã¦OKã€‚ã‚„ã•ã—ã„ä¸€è¨€ãŒé‹ã‚’å‹•ã‹ã™æ—¥ã€‚",
      "æ°—æŒã¡ã¯å¤–ã«å‡ºã—ã¦ã­ã€‚æŠ±ãˆãªã„ã§ã€‚"
    ],
    "WATER_WATER": [
      "ä»Šæ—¥ã¯ã­ã€ç™’ã—ãŒã„ã¡ã°ã‚“ã®é–‹é‹ã ã‚ˆã€‚ä¼‘ã‚“ã§ã„ã„æ—¥ã ã‚ˆã€œã€‚",
      "æ„Ÿæƒ…ãŒæºã‚ŒãŸã‚‰ã€ç„¡ç†ã«æ­£è§£æ¢ã•ãªãã¦ã„ã„ã®ã€‚è½ã¡ç€ã‘ã°å¤§ä¸ˆå¤«ã€‚",
      "è‡ªåˆ†ã«ã‚„ã•ã—ãã—ã¦ã‚ã’ã¦ã€‚ãã“ãŒä»Šæ—¥ã®å‹ã¡ãƒã‚¤ãƒ³ãƒˆã ã‚ˆã€‚"
    ],
  };

  const normal = {
    // normalã¯ softã®è¨€ã„å›ã—ã‚’å°‘ã—ã ã‘ã‚·ãƒ£ã‚­ãƒƒã¨ã•ã›ãŸç‰ˆ
  };

  const spicy = {
    // â€œå¥³ã®å­ã®æ¯’èˆŒâ€ã«å¯„ã›ã‚‹ï¼ˆå‘½ä»¤å£èª¿ã¯é¿ã‘ã‚‹ï¼‰
    "FIRE_FIRE": [
      "ä»Šæ—¥ã¯å‹¢ã„ãŒå¼·ã„æ—¥ã€‚è¿·ã£ã¦ã‚‹æ™‚é–“ã‚‚ã£ãŸã„ãªã„ã‚ˆï¼Ÿå°ã•ãã§ã„ã„ã‹ã‚‰ã€ã•ã£ã•ã¨å§‹ã‚ã¦ã€‚",
      "ã‚„ã‚‹æ°—å¾…ã¡ã¯ã‚„ã‚ã‚ˆã€‚æ‰‹ã‚’å‹•ã‹ã—ãŸåˆ†ã ã‘å‰ã«é€²ã‚€æ—¥ãªã‚“ã ã‹ã‚‰ã€å‹•ã„ã¦ã€‚",
      "æ±ºã‚ã¦ã€ã‚„ã£ã¦ã€‚ã‚ã¨ã§æ•´ãˆã‚Œã°ã„ã„ã‹ã‚‰ã€‚"
    ],
    "FIRE_EARTH": [
      "ä»Šæ—¥ã¯åœŸå°ã®æ—¥ã€‚æ•£ã‚‰ã‹ã£ã¦ã‚‹ã®ã«é€²ã¾ãªã„ã¨ã‹ã€ãã‚Šã‚ƒç„¡ç†ã ã‚ˆï¼Ÿå…ˆã«æ•´ãˆã¦ã€‚",
      "ã‚„ã‚‹ã“ã¨å¢—ã‚„ã™å‰ã«æ¸›ã‚‰ã—ã¦ã€‚ã§ããªã„ç†ç”±æ¢ã™å‰ã«ã€å‰Šã£ã¦ã€‚",
      "ã¾ãšä¸€å€‹ã ã‘ç‰‡ã¥ã‘ã¦ã€‚ãã‚Œã ã‘ã§æµã‚Œå¤‰ã‚ã‚‹ã‹ã‚‰ã€‚"
    ],
    "FIRE_AIR": [
      "ä»Šæ—¥ã¯è¨€è‘‰ãŒåŠ¹ãæ—¥ã€‚é ­ã®ä¸­ã§ãã‚‹ãã‚‹ã—ã¦ãªã„ã§ã€æ›¸ã„ã¦ã€‚é€ã£ã¦ã€‚è©±ã—ã¦ã€‚",
      "é€£çµ¡å¾Œå›ã—ã«ã—ã¦ã‚‹ãªã‚‰ã€ä»Šã—ã‚ˆï¼Ÿæºœã‚ã‚‹ã»ã©ã—ã‚“ã©ã„ã ã‘ã€‚",
      "ãƒ¡ãƒ¢ä¸€è¡Œã§ã„ã„ã€‚å‡ºã—ã¦ã€‚"
    ],
    "FIRE_WATER": [
      "ä»Šæ—¥ã¯æ°—æŒã¡ãŒæºã‚Œã‚„ã™ã„æ—¥ã€‚ã ã‹ã‚‰ã£ã¦ä¸å®‰ã«é£²ã¾ã‚Œãªã„ã§ã€‚è½ã¡ç€ãæ–¹é¸ã‚“ã§ã€‚",
      "ç„¡ç†ã«å…ƒæ°—å‡ºã•ãªãã¦ã„ã„ã‘ã©ã€å®ˆã‚‹ã¨ã“ã‚ã¯å®ˆã£ã¦ã€‚ç¡çœ ã¨ã‹ã­ã€‚",
      "å®‰å¿ƒã§ãã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¦ã€‚ã˜ã‚ƒãªã„ã¨å…¨éƒ¨ã¶ã‚Œã‚‹ã‚ˆã€‚"
    ],

    "EARTH_FIRE": [
      "ä»Šæ—¥ã¯å‹•ã„ãŸäººãŒå‹ã¤æ—¥ã€‚æº–å‚™ã°ã£ã‹ã—ã¦ãªã„ã§ã€ã²ã¨ã¤ã‚„ã£ã¦ã€‚",
      "å®Œç’§ã«æ•´ã£ã¦ã‹ã‚‰â€¦ã¨ã‹é…ã„ã€‚ä»Šã§ãã‚‹å½¢ã§å‡ºã—ã¦ã€‚",
      "è¿·ã†ãªã‚‰â€œä»Šã™ãã§ãã‚‹æ–¹â€ã€‚ã¯ã„ã€ãã£ã¡ã€‚"
    ],
    "EARTH_EARTH": [
      "ä»Šæ—¥ã¯æ•´ãˆã‚‹ã ã‘ã§å‹ã¦ã‚‹æ—¥ã€‚ç‰‡ã¥ã‘ã¦ã€‚äºˆå®šè¦‹ç›´ã—ã¦ã€‚çµ‚ã‚ã‚Šã€‚ç°¡å˜ã€‚",
      "ç©ã¿ä¸Šã’ã®æ—¥ãªã‚“ã ã‹ã‚‰ã€ã‚µãƒœã‚‹ã¨å¾Œã§è‡ªåˆ†ãŒå›°ã‚‹ã‚ˆï¼Ÿå°‘ã—ã ã‘ã§ã‚‚ã‚„ã£ã¦ã€‚",
      "ä¸€å€‹æ•´ãˆã¦ã€‚æ¬²å¼µã‚‰ãªã„ã§ã„ã„ã‹ã‚‰ã€‚"
    ],
    "EARTH_AIR": [
      "ä»Šæ—¥ã¯æ•´ç†ã¨è¨€èªåŒ–ã€‚ã‚„ã‚‹ã“ã¨å¢—ã‚„ã—ã¦ãƒ‘ãƒ³ã‚¯ã—ã¦ã‚‹ãªã‚‰ã€ã¾ãšçµã£ã¦ã€‚",
      "é€£çµ¡æºœã‚ã¦ã‚‹ï¼Ÿãã‚Œé‹è½ã¡ã‚‹ã‚„ã¤ã€‚çŸ­ãã§ã„ã„ã‹ã‚‰è¿”ã—ã¦ã€‚",
      "é ­ã®ä¸­ã‚’å¤–ã«å‡ºã—ã¦ã€‚æŠ±ãˆè¾¼ã¾ãªã„ã§ã€‚"
    ],
    "EARTH_WATER": [
      "ä»Šæ—¥ã¯å®‰å¿ƒãŒæœ€å„ªå…ˆã€‚ç„¡ç†ã—ã¦å´©ã™ã®ã€ã„ã¡ã°ã‚“ãƒ€ãƒ¡ã€‚è½ã¡ç€ã„ã¦ã€‚",
      "å›å¾©ã—ãªã„ã¨é€²ã¾ãªã„ã‚¿ã‚¤ãƒ—ã®æ—¥ã€‚ã ã‹ã‚‰ã€ã¡ã‚ƒã‚“ã¨ä¼‘ã‚“ã§ã€‚",
      "æ·±å‘¼å¸ã—ã¦ã€‚ã»ã‚“ã¨ã«ã€‚"
    ],

    "AIR_FIRE": [
      "ä»Šæ—¥ã¯ã²ã‚‰ã‚ãå¼·ã„ã€‚æ€ã„ã¤ã„ãŸã‚‰æ”¾ç½®ã—ãªã„ã§ã€è©¦ã—ã¦ã€‚ã‚‚ã£ãŸã„ãªã„ã€‚",
      "å‹¢ã„ã‚ã‚‹ã®ã«æ­¢ã¾ã£ã¦ã‚‹ã®ã€æ„å‘³ã‚ã‹ã‚“ãªã„ã‚ˆï¼Ÿå°ã•ãå‹•ã„ã¦ã€‚",
      "æ–°ã—ã„ã“ã¨ã€ã¡ã‚‡ã„è§¦ã‚Œã—ã¦ã€‚"
    ],
    "AIR_EARTH": [
      "ä»Šæ—¥ã¯å½¢ã«ã—ã¦å‹ã¤æ—¥ã€‚è€ƒãˆã¦ã‚‹ã ã‘ã§æº€è¶³ã—ãªã„ã§ï¼Ÿå‡ºã—ã¦ã€‚",
      "é›‘ã§ã‚‚ã„ã„ã‹ã‚‰ä¸€å›ä½œã£ã¦ã€‚ãã‚Œã‚’æ•´ãˆã¦ã„ã‘ã°ã„ã„ã‚“ã ã‹ã‚‰ã€‚",
      "ä¸€å€‹ã ã‘â€œå½¢â€ã«ã—ã¦ã€‚é€ƒã’ãªã„ã§ã€‚"
    ],
    "AIR_AIR": [
      "ä»Šæ—¥ã¯è¨€è‘‰ã®æ—¥ã€‚é»™ã£ã¦æ‚©ã‚€ã‚ˆã‚Šã€è©±ã—ã¦ã€‚æ›¸ã„ã¦ã€‚ç­”ãˆå‡ºã‚‹ã‹ã‚‰ã€‚",
      "ä¼šè©±ãŒãƒ’ãƒ³ãƒˆã«ãªã‚‹æ—¥ã€‚é–‰ã˜ã“ã‚‚ã‚‹ã®ã€æã ã‚ˆï¼Ÿ",
      "æƒ…å ±å›ã—ã¦ã€‚æŠ±ãˆãªã„ã€‚"
    ],
    "AIR_WATER": [
      "ä»Šæ—¥ã¯æ°—æŒã¡æ•´ç†ãŒå…ˆã€‚å¼·ãŒã£ã¦ã‚‚é€²ã¾ãªã„ã‚ˆï¼Ÿè½ã¡ç€ã„ã¦ã€‚",
      "å„ªã—ã„è¨€è‘‰ã‚’è‡ªåˆ†ã«ã‹ã‘ã¦ã€‚é›‘ã«æ‰±ã†ã¨ã€å…¨éƒ¨ãã¡ã‚ƒãã¡ã‚ƒã«ãªã‚‹ã‹ã‚‰ã€‚",
      "ç„¡ç†ã«æ˜ã‚‹ãã—ãªãã¦ã„ã„ã€‚é™ã‹ã«æ•´ãˆã¦ã€‚"
    ],

    "WATER_FIRE": [
      "ä»Šæ—¥ã¯æ„Ÿæƒ…ãŒå‹•ãã‚„ã™ã„ã€‚ã ã‹ã‚‰ã“ãã€ã²ã¨ã¤ã ã‘æ±ºã‚ã¦ã€‚æµã•ã‚Œãªã„ã§ã€‚",
      "è¿·ã£ã¦ã‚‚ã„ã„ã‘ã©ã€æ­¢ã¾ã‚‰ãªã„ã§ã€‚çŸ­æ™‚é–“ã ã‘é›†ä¸­ã—ã¦ã¿ã¦ã€‚",
      "å°ã•ãæ±ºã‚ã¦ã€‚å‹•ã„ã¦ã€‚"
    ],
    "WATER_EARTH": [
      "ä»Šæ—¥ã¯å®‰å¿ƒã®ç©ã¿ä¸Šã’ã€‚ç¡çœ ã€é£Ÿäº‹ã€ç‰‡ã¥ã‘ã€‚ãã“ã‚µãƒœã‚‹ã¨å…¨éƒ¨è½ã¡ã‚‹ã‚ˆï¼Ÿ",
      "ä¸å¯§ã«ã‚„ã‚‹ã»ã©å‹ã¦ã‚‹æ—¥ã€‚ç„¦ã£ã¦é›‘ã«ã—ãªã„ã§ã€‚",
      "åœŸå°æ•´ãˆã¦ã€‚ã»ã‚“ã¨ãã‚Œã ã‘ã€‚"
    ],
    "WATER_AIR": [
      "ä»Šæ—¥ã¯è©±ã™ã¨æ¥½ã«ãªã‚‹æ—¥ã€‚æºœã‚ãªã„ã§è¨€ã£ã¦ã€‚æŠ±ãˆã‚‹ã®ã‚„ã‚ã¦ã€‚",
      "é€£çµ¡ã¯çŸ­ãã¦OKã€‚ã‚„ã•ã—ã„ä¸€è¨€ãŒé‹ã‚’å‹•ã‹ã™ã‹ã‚‰ã€‚",
      "æ°—æŒã¡å¤–ã«å‡ºã—ã¦ã€‚"
    ],
    "WATER_WATER": [
      "ä»Šæ—¥ã¯ç™’ã—æœ€å„ªå…ˆã€‚é ‘å¼µã‚‹æ—¥ã˜ã‚ƒãªã„ã€‚ä¼‘ã‚“ã§ã€‚",
      "æ„Ÿæƒ…ãŒæºã‚Œã¦ã‚‚ã€æ­£è§£æ¢ã—ã§è¿½ã„è©°ã‚ãªã„ã§ã€‚è½ã¡ç€ã‘ã°æˆ»ã‚‹ã‹ã‚‰ã€‚",
      "è‡ªåˆ†ã«ã‚„ã•ã—ãã—ã¦ã€‚é›‘ã«æ‰±ã£ãŸã‚‰ã€é‹ã‚‚é›‘ã«ãªã‚‹ã‚ˆï¼Ÿ"
    ],
  };

  // keyä¾‹ï¼šFIRE_EARTH_3 â†’ ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å…ˆé ­2ã¤ã ã‘è¦‹ã‚Œã°OK
  const [todayMood, yourBase] = key.split("_");
  const k2 = `${todayMood}_${yourBase}`;

  if (toneKey === "soft") return soft[k2] ?? soft["EARTH_EARTH"];
  if (toneKey === "spicy") return spicy[k2] ?? spicy["EARTH_EARTH"];
  // normalã¯ softã®æ–‡ç« ã‚’å°‘ã—ã ã‘çŸ­ãã—ã¦ä½¿ã†ï¼ˆæœªå®šç¾©ãªã‚‰softæµç”¨ï¼‰
  return (normal[k2] ?? soft[k2] ?? soft["EARTH_EARTH"]).map(s => s.replaceAll("ã€œ", "").replaceAll("ã ã‚ˆã€œ", "ã ã‚ˆ"));
}

function pickDeterministic(list, seedStr){
  const x = hash01(seedStr);
  const idx = Math.floor(x * list.length);
  return list[Math.min(idx, list.length-1)];
}

function makeTodayOneLine(ctx){
  const key = todayKeyFrom(ctx);
  const pool = todayLinePool(ctx.toneKey, key);

  // æ¯æ—¥åŒã˜å…¥åŠ›ãªã‚‰åŒã˜çµæœï¼š dob + todayStr + typeKey + tone
  const seed = `${ctx.dobStr}|${ctx.todayStr}|${ctx.typeKey}|${ctx.toneKey}`;
  return pickDeterministic(pool, seed);
}

/* =========
  å…¬é–‹æ–‡ç« ï¼ˆå°‚é–€ç”¨èªã‚¼ãƒ­ãƒ»ä¼šè©±èª¿ï¼‰
========= */
function makePublicText(ctx){
  const tonePack = TEXT_DB.tone[ctx.toneKey] ?? TEXT_DB.tone.normal;
  const type = TEXT_DB.types20[ctx.typeKey];
  const name = ctx.name?.trim() ? ctx.name.trim() : "ã‚ãªãŸ";

  const face = TEXT_DB.faceLabel[ctx.sunSign] ?? "ã‚¿ã‚¤ãƒ—ä¸æ˜";
  const core = ctx.moonSignInfo.includes("å€™è£œ")
    ? "æœ¬éŸ³ãŒäºŒæŠã£ã½ã„ï¼ˆå‡ºç”Ÿæ™‚é–“ã§ç¢ºå®šã™ã‚‹ã‚ˆï¼‰"
    : (TEXT_DB.coreLabel[ctx.moonSign] ?? "æœ¬éŸ³ã®ã‚¯ã‚»ä¸æ˜");
  const numLabel = TEXT_DB.numLabel[ctx.lp] ?? "";

  const todayOne = makeTodayOneLine(ctx);

  const lines = [];

  lines.push(`# ğŸ» ${type.name}`);
  lines.push(`${name}ã¯ã­ã€ã–ã£ãã‚Šè¨€ã†ã¨ã€Œ${type.desc}ã€ã£ã¦æ„Ÿã˜ã ã‚ˆã€‚`);
  lines.push("");

  lines.push(`## ä»Šæ—¥ã®ã²ã¨ã“ã¨`);
  lines.push(`${todayOne}`);
  lines.push("");

  lines.push(`## ã¾ãšã¯å®‰å¿ƒã—ã¦ã­`);
  if (ctx.toneKey === "soft"){
    lines.push(`ä»Šæ—¥ã®ã‚ãªãŸã€ã¡ã‚ƒã‚“ã¨é€²ã‚ã‚‹æ—¥ã ã‚ˆã€‚ã ã‹ã‚‰ã­ã€æ€–ãŒã‚‰ãªãã¦ã„ã„ã®ã€‚`);
    lines.push(`ã§ãã‚‹ã“ã¨ã‚’ã€ã§ãã‚‹åˆ†ã ã‘ã§ã„ã„ã‚ˆã€œã€‚ãã‚Œã§ã‚‚é‹ã¯å‹•ãã‹ã‚‰ã­ã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`ä»Šæ—¥ã®ã‚ãªãŸã€ã¡ã‚ƒã‚“ã¨é€²ã‚ã‚‹ã€‚ãªã®ã«æ­¢ã¾ã‚‹ã®ã¯ã€ãŸã ã®ã‚‚ã£ãŸã„ãªã„ã ã‚ˆï¼Ÿ`);
    lines.push(`ã§ãã‚‹åˆ†ã§ã„ã„ã‘ã©ã€â€œã‚„ã‚‹â€ã¯ã‚„ã£ã¦ã€‚ãã“ã¯ç”˜ãˆãªã„ã§ã€‚`);
  } else {
    lines.push(`ä»Šæ—¥ã¯ã¡ã‚ƒã‚“ã¨é€²ã‚ã‚‹æ—¥ã€‚ã‚„ã‚‹ã“ã¨ã‚’çµã£ã¦å‹•ã‘ã°OKã€‚`);
  }
  lines.push("");

  lines.push(`## ${name}ã®é›°å›²æ°—`);
  lines.push(`å¤–ã§è¦‹ã›ã‚‹é¡”ã¯ã€Œ${face}ã€ã ã‚ˆã€‚ã ã‹ã‚‰å‘¨ã‚Šã‹ã‚‰ã¯ãã†è¦‹ã‚‰ã‚Œã‚„ã™ã„ã€‚`);
  lines.push(`ã§ã‚‚æœ¬éŸ³ã®ã‚¯ã‚»ã¯ã€Œ${core}ã€ã€‚ã“ã“åˆ†ã‹ã£ã¦ã‚‹ã¨ã€ç„¡é§„ã«ç–²ã‚Œã«ãã„ã‚ˆã€‚`);
  lines.push(`ãã‚Œã¨ã€èª•ç”Ÿæ—¥ã®æ•°å­—ã¯ã€Œ${ctx.lp}ï¼ˆ${numLabel}ï¼‰ã€ã€‚ã‚ãªãŸã®ä¼¸ã³æ–¹ã®ã‚¯ã‚»ã€ã¿ãŸã„ãªã‚‚ã®ã ã‚ˆã€‚`);
  if (ctx.timeLabel === "ä¸æ˜"){
    lines.push(`å‡ºç”Ÿæ™‚é–“ã¯ä¸æ˜ã§ã‚‚å¤§ä¸ˆå¤«ã ã‚ˆã€‚å¿…è¦ãªã¨ã“ã‚ã¯â€œå€™è£œâ€ã§ä¸å¯§ã«å‡ºã—ã¦ã‚‹ã‹ã‚‰ã­ã€‚`);
  } else {
    lines.push(`å‡ºç”Ÿæ™‚é–“ã¯ã€Œ${ctx.timeLabel}ã€ã§è¦‹ã¦ã‚‹ã‚ˆã€‚`);
  }
  lines.push("");

  lines.push(`## ä»•äº‹`);
  if (ctx.toneKey === "soft"){
    lines.push(`ä»•äº‹ã¯ã­ã€é ‘å¼µã‚Šæ–¹ã‚’é–“é•ãˆãªã‘ã‚Œã°ã¡ã‚ƒã‚“ã¨ä¼¸ã³ã‚‹ã‚ˆã€‚`);
    lines.push(`ä»Šæ—¥ã¯ã€Œå°ã•ãå‡ºã—ã¦ã€ã‚ã¨ã§æ•´ãˆã‚‹ã€ãŒå‘ã„ã¦ã‚‹æ—¥ã ã‚ˆã€œã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`ä»•äº‹ã­ã€‚å®Œç’§ã«ã—ã¦ã‹ã‚‰â€¦ã£ã¦ã‚„ã£ã¦ã‚‹ã¨é…ã„ã‚ˆï¼Ÿ`);
    lines.push(`ä»Šæ—¥ã¯ã€Œå°ã•ãå‡ºã—ã¦ã€å›ã—ãªãŒã‚‰æ•´ãˆã‚‹ã€ã£ã¦ã‚„ã£ã¦ã€‚`);
  } else {
    lines.push(`ä»•äº‹ã¯ã€Œå°ã•ãå‡ºã—ã¦å›ã™ã€ãŒå¼·ã„æ—¥ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬åŒ–ã‚‚åŠ¹ãã€‚`);
  }
  lines.push("");

  lines.push(`## ãŠé‡‘`);
  if (ctx.toneKey === "soft"){
    lines.push(`ãŠé‡‘ã£ã¦ä¸å®‰ã«ãªã‚Šã‚„ã™ã„ã‚ˆã­ã€‚ã§ã‚‚ã­ã€ä»•çµ„ã¿ã«ã™ã‚‹ã¨è½ã¡ç€ãã‚ˆã€‚`);
    lines.push(`ä»Šæ—¥ã¯â€œãƒ«ãƒ¼ãƒ«ã‚’1å€‹ã ã‘â€ä½œã‚‹ã¨å®‰å¿ƒãŒå¢—ãˆã‚‹æ—¥ã ã‚ˆã€œã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`ãŠé‡‘ã¯æ„Ÿæƒ…ã§è§¦ã‚‹ã¨è² ã‘ã‚‹ã®ã€‚ã ã‹ã‚‰ã€æ•°å­—ã‚’è¦‹ã¦ã€‚é€ƒã’ãªã„ã§ã€‚`);
    lines.push(`ä»Šæ—¥ã¯å›ºå®šè²»ã‹ãƒ«ãƒ¼ãƒ«ã‚’1å€‹ã ã‘æ•´ãˆã¦ã€‚æœªæ¥ã®è‡ªåˆ†ãŒæ¥½ã«ãªã‚‹ã‹ã‚‰ã€‚`);
  } else {
    lines.push(`ãŠé‡‘ã¯ãƒ«ãƒ¼ãƒ«åŒ–ãŒæœ€å¼·ã€‚ä»Šæ—¥ã¯1ã¤ä»•çµ„ã¿ã‚’æ•´ãˆã‚‹ã¨å®‰å®šã™ã‚‹ã€‚`);
  }
  lines.push("");

  lines.push(`## æ‹æ„›`);
  if (ctx.toneKey === "soft"){
    lines.push(`æ‹æ„›ã¯ã­ã€ç„¦ã‚‰ãªãã¦ã„ã„ã‚ˆã€‚åˆã†äººã»ã©ä¼šè©±ãŒè‡ªç„¶ã«æ¥½ã—ã„ã‹ã‚‰ã­ã€œã€‚`);
    lines.push(`ä»Šæ—¥ã¯â€œå®‰å¿ƒã§ãã‚‹ãƒšãƒ¼ã‚¹â€ã‚’å¤§äº‹ã«ã—ã¦ã¿ã¦ã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`æ‹æ„›ã€‚é›‘ã«æ‰±ã†äººã«æ™‚é–“ã‚ã’ãªã„ã§ã­ï¼Ÿã‚‚ã£ãŸã„ãªã„ã‹ã‚‰ã€‚`);
    lines.push(`ç›¸æ‰‹ã®è¨€è‘‰ã‚ˆã‚Šã€è¡Œå‹•ã¨ç”Ÿæ´»ã®ä¸å¯§ã•ã‚’è¦‹ã¦ã€‚ãã“ã«æœ¬æ€§å‡ºã‚‹ã‚ˆã€‚`);
  } else {
    lines.push(`æ‹æ„›ã¯ã€Œä¼šè©±ã®æ°—æŒã¡ã‚ˆã•ã€ãŒéµã€‚ç„¡ç†ã—ãªã„ç›¸æ‰‹ãŒå½“ãŸã‚Šã€‚`);
  }
  lines.push("");

  lines.push(`## å¥åº·`);
  if (ctx.toneKey === "soft"){
    lines.push(`å¥åº·ã¯ã­ã€ã‚ãªãŸã‚’å®ˆã‚‹åœŸå°ã ã‚ˆã€‚ã ã‹ã‚‰ä¸å¯§ã«æ‰±ã£ã¦ã‚ã’ã‚ˆï¼Ÿ`);
    lines.push(`ä»Šæ—¥ã¯ç¡çœ ã¨å‘¼å¸ã‚’ã¡ã‚‡ã£ã¨ã ã‘æ„è­˜ã—ã¦ã€‚ã»ã‚“ã¨ã«ãã‚Œã ã‘ã§é•ã†ã‚ˆã€œã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`å¥åº·ã€‚å¯ãªã„ã¨å´©ã‚Œã‚‹ã‚ˆï¼Ÿã»ã‚“ã¨ã€‚`);
    lines.push(`ä»Šæ—¥ã¯å›å¾©ã«å¯„ã›ã¦ã€‚ã¡ã‚ƒã‚“ã¨å¯ã¦ã€ã¡ã‚ƒã‚“ã¨æˆ»ã—ã¦ã€‚`);
  } else {
    lines.push(`å¥åº·ã¯ç¡çœ ã¨é£Ÿäº‹ãŒãƒ™ãƒ¼ã‚¹ã€‚ä»Šæ—¥ã¯å›å¾©å¯„ã‚Šã«ã™ã‚‹ã¨å®‰å®šã€‚`);
  }
  lines.push("");

  lines.push(tonePack.header);
  lines.push(tonePack.closer);

  return lines.join("\n");
}

/* =========
  è£ãƒ¡ãƒ¢ï¼ˆå°‚é–€ç”¨èªã‚ã‚Šï¼‰
========= */
function makeDevText(ctx){
  const lines = [];
  lines.push(`Kuma Fortune / Version 1.3`);
  lines.push(`---`);
  lines.push(`[å…¥åŠ›]`);
  lines.push(`name=${ctx.name || ""}`);
  lines.push(`dob=${ctx.dobStr}`);
  lines.push(`place=${ctx.place}`);
  lines.push(`time=${ctx.timeLabel}`);
  lines.push(`tone=${ctx.toneKey}`);
  lines.push(`today=${ctx.todayStr}`);
  lines.push(``);
  lines.push(`[è¨ˆç®—ï¼ˆå°‚é–€ç”¨èªã‚ã‚Šï¼‰]`);
  lines.push(`Sun sign=${ctx.sunSign}`);
  lines.push(`Moon sign=${ctx.moonSignInfo}`);
  lines.push(`Mercury sign=${ctx.mercurySign}`);
  lines.push(`Venus sign=${ctx.venusSign}`);
  lines.push(`Mars sign=${ctx.marsSign}`);
  lines.push(`LifePath=${ctx.lp}`);
  lines.push(`typeKey=${ctx.typeKey}`);
  lines.push(``);
  lines.push(`[ä¸»è¦ã‚¢ã‚¹ãƒšã‚¯ãƒˆï¼ˆç°¡æ˜“ï¼‰]`);
  const aspPairs = [
    ["Sun","Moon","sun","moon"],
    ["Sun","Mars","sun","mars"],
    ["Mercury","Mars","mercury","mars"],
    ["Venus","Mars","venus","mars"],
    ["Sun","Venus","sun","venus"],
  ];
  for (const [A,B,ka,kb] of aspPairs){
    const a = ctx.lons[ka], b = ctx.lons[kb];
    const asp = aspectBetween(a,b);
    if (asp) lines.push(`${A} x ${B}: ${asp}`);
  }
  lines.push(``);
  lines.push(`[ãƒˆãƒ©ãƒ³ã‚¸ãƒƒãƒˆï¼ˆä»Šæ—¥ï¼‰]`);
  lines.push(`Today Sun=${ctx.todaySigns.sun}`);
  lines.push(`Today Moon=${ctx.todaySigns.moon}`);
  lines.push(`Today Mars=${ctx.todaySigns.mars}`);
  lines.push(``);
  lines.push(`[ä»Šæ—¥ã®ã²ã¨ã“ã¨ãƒ­ã‚¸ãƒƒã‚¯]`);
  lines.push(`todayKey=${todayKeyFrom(ctx)}  (moodElement_todayMoon Ã— yourElement Ã— yourStep)`);
  return lines.join("\n");
}

/* å…¬é–‹API */
export function buildTexts(ctx){
  const type = TEXT_DB.types20[ctx.typeKey] ?? { name:"ãªãã®ã‚¯ãƒ", desc:"ã‚¿ã‚¤ãƒ—æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€‚", tags:"-" };
  return {
    type,
    publicText: makePublicText(ctx),
    devText: makeDevText(ctx)
  };
}
