/*
  fortune.js / Version 1
  ------------------------------------------------------------
  âœ… åˆå¿ƒè€…å‘ã‘ï¼šã“ã“ãŒâ€œå ã„æ–‡ç« â€ã®ä¸­å¿ƒ
  è§¦ã‚‹å ´æ‰€ï¼š
    1) TEXT_DB.types20ï¼ˆã‚¿ã‚¤ãƒ—å/è¦ç´„ï¼‰
    2) TEXT_DB.toneï¼ˆå£èª¿ï¼‰
    3) POOLSï¼ˆä»Šæ—¥ã®ã²ã¨ã“ã¨/3ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
*/

import { pickDeterministic, uniq3 } from "./utils.js";

/* =========================
  å£èª¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚„ã•ã—ã‚/æ¨™æº–/æ¯’èˆŒï¼‰
========================= */
export const TEXT_DB = {
  tone: {
    soft: {
      header: "ã†ã‚“ã€ã¡ã‚ƒã‚“ã¨è¦‹ãŸã‚ˆã€‚å¤§ä¸ˆå¤«ã ã‚ˆã€‚ä»Šæ—¥ã¯ç§ãŒã‚ãªãŸã®å‘³æ–¹ã­ã€‚",
      closer: "ç„¦ã‚‰ãªãã¦ã„ã„ã®ã€‚ã§ãã‚‹å½¢ã§ã€ã²ã¨ã¤ãšã¤ã€‚ä»Šæ—¥ã¯â€œã§ããŸâ€ã‚’ä¸€å€‹ä½œã‚ï¼Ÿ",
    },
    normal: {
      header: "å‚¾å‘ã‚’ã¾ã¨ã‚ã‚‹ã­ã€‚ç¾å®Ÿã§ä½¿ãˆã‚‹å½¢ã«è½ã¨ã™ã‚ˆã€‚",
      closer: "é‹ã¯è¡Œå‹•ã§å¤‰ã‚ã‚‹ã€‚åˆã†å‹•ãã‚’é¸ã¹ã°ã€æµã‚Œã¯ã¡ã‚ƒã‚“ã¨è‰¯ããªã‚‹ã‚ˆã€‚",
    },
    spicy: {
      header: "ã¯ã„ã€è¦‹ãŸã€‚ã§ï¼Ÿã¾ã è¿·ã£ã¦ã‚‹ã®ï¼Ÿãã®æ™‚é–“ã§ä¸€å€‹çµ‚ã‚ã£ã¦ãŸã‚ˆã­ï¼Ÿ",
      closer: "åˆºã•ã£ãŸï¼Ÿã§ã‚‚ãã‚Œã€ä¼¸ã³ã‚‹å ´æ‰€ãŒåˆ†ã‹ã£ãŸã£ã¦ã“ã¨ã ã‚ˆã€‚ã»ã‚‰ã€æ¬¡ã„ã“ã€‚",
    }
  },

  /* 20ã‚¿ã‚¤ãƒ—ï¼ˆã‹ã‚ã„ã„ï¼‰ */
  types20: {
    "FIRE_1":  { name:"ã»ã‹ã»ã‹è¦‹å®ˆã‚Šã‚°ãƒž", desc:"å®‰å¿ƒã§ãã‚‹åœŸå°ãŒã§ããŸçž¬é–“ã€é‹ã¯ä¸€æ°—ã«ä¼¸ã³ã‚‹ã‚ˆã€‚", tags:"ç«Ã—å®‰å®š" },
    "FIRE_2":  { name:"ãƒ¡ãƒ©ãƒ¡ãƒ©ç·´ç¿’ã‚°ãƒž",   desc:"åå¾©ãŒæ‰èƒ½ã€‚åœ°å‘³ã«è¦‹ãˆã¦ã€ã„ã¡ã°ã‚“å¼·ã„è‚²ã¡æ–¹ã ã‚ˆã€‚", tags:"ç«Ã—æˆé•·" },
    "FIRE_3":  { name:"ãƒ‰ãƒƒã‚«ãƒ³çªæ’ƒã‚°ãƒž",   desc:"æ±ºã‚ã¦å‹•ã„ãŸçž¬é–“ãŒæœ€å¼·ã€‚è¿·ã„ã§æ­¢ã¾ã‚‹ã®ã ã‘æã ã‚ˆã€‚", tags:"ç«Ã—æŒ‘æˆ¦" },
    "FIRE_4":  { name:"ã²ã‚‰ã‚ãå†’é™ºã‚°ãƒž",   desc:"é¢ç™½ã„æ–¹ã¸è¡Œãã»ã©é‹ãŒé–‹ãã€‚ä½“é¨“ãŒæ­£è§£ã«ãªã‚‹ã‚ˆã€‚", tags:"ç«Ã—æŽ¢ç©¶" },
    "FIRE_5":  { name:"ã”ã»ã†ã³é”æˆã‚°ãƒž",   desc:"æœ€å¾Œã«å‹ã¤ã€‚ã‚„ã‚ãªã„é™ã‚Šè² ã‘ãªã„ã‚¿ã‚¤ãƒ—ã ã‚ˆã€‚", tags:"ç«Ã—å®Œæˆ" },

    "EARTH_1": { name:"ã‚‚ãµã‚‚ãµåŸºç¤Žã‚°ãƒž",   desc:"æ•´ãˆãŸåˆ†ã ã‘å®‰å®šã™ã‚‹ã€‚ç”Ÿæ´»ã®åœŸå°ãŒæ­¦å™¨ã ã‚ˆã€‚", tags:"åœ°Ã—å®‰å®š" },
    "EARTH_2": { name:"ã‚³ãƒ„ã‚³ãƒ„è·äººã‚°ãƒž",   desc:"ç©ã¿ä¸Šã’ãŒè£åˆ‡ã‚‰ãªã„ã€‚æ°—ã¥ã„ãŸã‚‰å¼·ã„ã‚ˆã€‚", tags:"åœ°Ã—æˆé•·" },
    "EARTH_3": { name:"ç¾å®Ÿã¤ã‚ˆã¤ã‚ˆã‚°ãƒž",   desc:"å‹ã¡ç­‹ã‚’ä½œã£ã¦ã‹ã‚‰æ”»ã‚ã‚‹ã€‚ä»•çµ„ã¿ã«ã§ãã‚‹ã‚ˆã€‚", tags:"åœ°Ã—æŒ‘æˆ¦" },
    "EARTH_4": { name:"é»™ã€…ç ”ç©¶ã‚°ãƒž",       desc:"æ·±æŽ˜ã‚Šã™ã‚‹ã»ã©è©•ä¾¡ãŒä¸ŠãŒã‚‹ã€‚é™ã‹ã«å¼·ã„ã‚ˆã€‚", tags:"åœ°Ã—æŽ¢ç©¶" },
    "EARTH_5": { name:"æ•´ãˆå®Œäº†ã‚°ãƒž",       desc:"åŒºåˆ‡ã£ã¦æ¬¡ã¸è¡Œã‘ã‚‹ã€‚ç‰‡ã¥ã‘ã‚‹ã»ã©é‹ãŒå…¥ã‚‹ã‚ˆã€‚", tags:"åœ°Ã—å®Œæˆ" },

    "AIR_1":   { name:"ãµã‚ã£ã¨èª¿æ•´ã‚°ãƒž",   desc:"ç©ºæ°—ã‚’æ•´ãˆã‚‹ã¨ãƒ©ã‚¯ã«ãªã‚‹ã€‚ç„¡ç†ã—ãªã„ã®ã«å¼·ã„ã‚ˆã€‚", tags:"é¢¨Ã—å®‰å®š" },
    "AIR_2":   { name:"ãŠã—ã‚ƒã¹ã‚Šæˆé•·ã‚°ãƒž", desc:"è¨€è‘‰ã¨æƒ…å ±ã§ä¼¸ã³ã‚‹ã€‚ç™ºä¿¡ãŒé‹ã®ã‚¹ã‚¤ãƒƒãƒã ã‚ˆã€‚", tags:"é¢¨Ã—æˆé•·" },
    "AIR_3":   { name:"ã‚¹ãƒ”ãƒ¼ãƒ‰è»¢èº«ã‚°ãƒž",   desc:"åˆ‡ã‚Šæ›¿ãˆãŒæ—©ã„ã€‚å‹•ã„ãŸå›žæ•°ãŒæœªæ¥ã«ãªã‚‹ã‚ˆã€‚", tags:"é¢¨Ã—æŒ‘æˆ¦" },
    "AIR_4":   { name:"ã‚¢ã‚¤ãƒ‡ã‚¢é£›è¡Œã‚°ãƒž",   desc:"ã²ã‚‰ã‚ãã‚’å½¢ã«ã§ããŸã‚‰æœ€å¼·ã€‚æ€ã„ã¤ãã§çµ‚ã‚ã‚‰ã›ãªã„ã§ã­ã€‚", tags:"é¢¨Ã—æŽ¢ç©¶" },
    "AIR_5":   { name:"è¨€èªžåŒ–ã¾ã¨ã‚ã‚°ãƒž",   desc:"æ•´ç†ã—ãŸçž¬é–“ã«å‹ã¤ã€‚è¨€è‘‰ã«ã§ããŸã‚‰ç¾å®ŸãŒã¤ã„ã¦ãã‚‹ã‚ˆã€‚", tags:"é¢¨Ã—å®Œæˆ" },

    "WATER_1": { name:"ã—ã£ã¨ã‚Šå®‰å¿ƒã‚°ãƒž",   desc:"å±…å ´æ‰€ãŒã§ãã‚‹ã¨å¼·ã„ã€‚ç¸ãŒåœŸå°ã«ãªã‚‹ã‚ˆã€‚", tags:"æ°´Ã—å®‰å®š" },
    "WATER_2": { name:"ã˜ã‚ã˜ã‚è‚²æˆã‚°ãƒž",   desc:"è‚²ã¦ãŸã‚‚ã®ãŒè²¡ç”£ã€‚ã˜ã‚ã˜ã‚å¼·ã„ã®ãŒæœ¬ç‰©ã ã‚ˆã€‚", tags:"æ°´Ã—æˆé•·" },
    "WATER_3": { name:"è¦šæ‚Ÿã‚¬ãƒæ‹ã‚°ãƒž",     desc:"æœ¬æ°—ã‚’æ±ºã‚ãŸã‚‰å¼·ã„ã€‚è¦šæ‚ŸãŒæµã‚Œã‚’å‹•ã‹ã™ã‚ˆã€‚", tags:"æ°´Ã—æŒ‘æˆ¦" },
    "WATER_4": { name:"æ·±æµ·èª­ã¿è§£ãã‚°ãƒž",   desc:"æœ¬è³ªã‚’è¦‹æŠœãã€‚æ·±ãèª­ã‚“ã åˆ†ã ã‘ç­”ãˆãŒå‡ºã‚‹ã‚ˆã€‚", tags:"æ°´Ã—æŽ¢ç©¶" },
    "WATER_5": { name:"æµ„åŒ–ãƒªã‚»ãƒƒãƒˆã‚°ãƒž",   desc:"æ‰‹æ”¾ã—ãŒé–‹é‹ã€‚åŒºåˆ‡ã‚‹ã»ã©æ¬¡ãŒå…¥ã‚‹ã‚ˆã€‚", tags:"æ°´Ã—å®Œæˆ" },
  },
};

/* =========================
  è¨ˆç®—ï¼šæ•°ç§˜ï¼ˆç°¡æ˜“ï¼‰
========================= */
export function lifePath(dobStr){
  const s = dobStr.replaceAll("-", "");
  let sum = 0;
  for (const ch of s) sum += Number(ch);
  while (sum > 9) sum = String(sum).split("").reduce((a,c)=>a+Number(c),0);
  return sum || 9;
}

/* =========================
  æ˜Ÿåº§ï¼ˆå¤ªé™½æ˜Ÿåº§ï¼‰è¨ˆç®—
  â€»ã“ã“ã¯ä¸€èˆ¬çš„ãªå¢ƒç•Œï¼ˆåŽ³å¯†ã§ã¯ãªã„ï¼‰
========================= */
export function calcZodiacSign(dateObj){
  const m = dateObj.getMonth() + 1;
  const d = dateObj.getDate();
  if ((m==1 && d>=20) || (m==2 && d<=18)) return "æ°´ç“¶åº§";
  if ((m==2 && d>=19) || (m==3 && d<=20)) return "é­šåº§";
  if ((m==3 && d>=21) || (m==4 && d<=19)) return "ç‰¡ç¾Šåº§";
  if ((m==4 && d>=20) || (m==5 && d<=20)) return "ç‰¡ç‰›åº§";
  if ((m==5 && d>=21) || (m==6 && d<=21)) return "åŒå­åº§";
  if ((m==6 && d>=22) || (m==7 && d<=22)) return "èŸ¹åº§";
  if ((m==7 && d>=23) || (m==8 && d<=22)) return "ç…å­åº§";
  if ((m==8 && d>=23) || (m==9 && d<=22)) return "ä¹™å¥³åº§";
  if ((m==9 && d>=23) || (m==10 && d<=23)) return "å¤©ç§¤åº§";
  if ((m==10 && d>=24) || (m==11 && d<=22)) return "è åº§";
  if ((m==11 && d>=23) || (m==12 && d<=21)) return "å°„æ‰‹åº§";
  return "å±±ç¾Šåº§";
}

/* =========================
  ã‚¿ã‚¤ãƒ—æ±ºå®šï¼ˆ20ã‚¿ã‚¤ãƒ—ï¼‰
  ãƒ»å¤ªé™½æ˜Ÿåº§ â†’ 4å…ƒç´ 
  ãƒ»æ•°ç§˜ â†’ 5æ®µéšŽ
========================= */
export function signElement(sign){
  const fire  = ["ç‰¡ç¾Šåº§","ç…å­åº§","å°„æ‰‹åº§"];
  const earth = ["ç‰¡ç‰›åº§","ä¹™å¥³åº§","å±±ç¾Šåº§"];
  const air   = ["åŒå­åº§","å¤©ç§¤åº§","æ°´ç“¶åº§"];
  if (fire.includes(sign)) return "FIRE";
  if (earth.includes(sign)) return "EARTH";
  if (air.includes(sign)) return "AIR";
  return "WATER";
}
function lpBucket(lp){
  if (lp === 9) return 5;
  if (lp === 7 || lp === 8) return 4;
  if (lp === 5 || lp === 6) return 3;
  if (lp === 3 || lp === 4) return 2;
  return 1;
}
export function typeKeyFrom(sunSign, lp){
  return `${signElement(sunSign)}_${lpBucket(lp)}`;
}

/* =========================
  ä»Šæ—¥ã®ãŠã¾ã‘ï¼ˆæ ¹æ‹ ï¼šä»Šæ—¥ã®æœˆÃ—ã‚ãªãŸã®å…ƒç´ ï¼‰
  â€»â€œäººç”Ÿé‘‘å®šãŒãƒ¡ã‚¤ãƒ³â€ãªã®ã§ã€ãŠã¾ã‘ã¯çŸ­ãã—ã¦ã„ã‚‹
========================= */
function todayKey(ctx){
  const todayElem = ctx.todayElem;     // ä»Šæ—¥ã®æœˆã®å…ƒç´ ï¼ˆç°¡æ˜“ï¼‰
  const youElem   = ctx.youElem;       // ã‚ãªãŸã®å…ƒç´ 
  return `${todayElem}_${youElem}`;
}

/* è§¦ã‚‹å ´æ‰€ï¼šã“ã“ã‚’å¢—ã‚„ã™ã¨å½“ãŸã‚Šæ„ŸãŒå¢—ãˆã‚‹ */
const POOLS = {
  soft: {
    "EARTH_EARTH": {
      one: [
        "ä»Šæ—¥ã¯ã­ã€æ•´ãˆã‚‹ã ã‘ã§å®‰å¿ƒãŒå¢—ãˆã‚‹æ—¥ã ã‚ˆã€‚ã²ã¨ã¤ã ã‘ã§ã„ã„ã®ã€‚",
        "ç„¦ã‚‰ãªãã¦å¤§ä¸ˆå¤«ã€‚åœŸå°ã‚’æ•´ãˆã‚‹ã»ã©é‹ãŒå®‰å®šã™ã‚‹æ—¥ã ã‚ˆã€‚"
      ],
      steps: [
        "æœºã‹äºˆå®šã€ã©ã£ã¡ã‹1ã¤ã ã‘æ•´ãˆã‚ˆï¼Ÿ",
        "ã‚„ã‚‹ã“ã¨ã‚’1å€‹ã«çµžã£ã¦ã¿ã¦ã€‚",
        "çµ‚ã‚ã£ãŸã‚‰ã€ã¡ã‚ƒã‚“ã¨ä¼‘ã‚‚ï¼Ÿ"
      ]
    },
    "FIRE_FIRE": {
      one: [
        "ä»Šæ—¥ã¯ã­ã€å‹¢ã„ãŒå‘³æ–¹ã€‚å°ã•ãã§ã„ã„ã‹ã‚‰æœ€åˆã®ä¸€æ­©ã ã‘è¸ã¿å‡ºã—ã¦ã¿ã‚ˆï¼Ÿ",
        "å‹•ã„ãŸã‚‰è»½ããªã‚‹æ—¥ã€‚ã¾ãšä¸€å›žã ã‘å§‹ã‚ã¦ã¿ã¦ã€‚"
      ],
      steps: [
        "ã„ã¡ã°ã‚“å°ã•ã„ä½œæ¥­ã‚’1å€‹ã ã‘æ±ºã‚ã‚ˆï¼Ÿ",
        "10åˆ†ã ã‘æ‰‹ã‚’å‹•ã‹ã—ã¦ã¿ã¦ã€‚",
        "ã§ããŸã‚‰è‡ªåˆ†ã‚’è¤’ã‚ã¦ã€çµ‚ã‚ã‚Šã€‚"
      ]
    }
  },
  normal: {
    "EARTH_EARTH": {
      one: ["ä»Šæ—¥ã¯åœŸå°ã¥ãã‚ŠãŒåŠ¹ãæ—¥ã€‚æ•´ãˆã‚‹ã»ã©å®‰å®šã™ã‚‹ã€‚"],
      steps: ["æ•´ç†ã™ã‚‹","1ã¤ã ã‘é€²ã‚ã‚‹","ä¼‘ã‚€"]
    }
  },
  spicy: {
    "EARTH_EARTH": {
      one: [
        "â€œã„ã¤ã‹ã‚„ã‚‹â€ã£ã¦è¨€ã£ã¦ã‚‹ã†ã¡ã¯ä½•ã‚‚å¤‰ã‚ã‚‰ãªã„ã‚ˆã€‚ä»Šæ—¥ã¡ã‚‡ã£ã¨é€²ã‚ã¦ã€‚",
        "æ•´ãˆã‚‹ã ã‘ã§å‹ã¦ã‚‹æ—¥ãªã®ã«ã€ã‚„ã‚‰ãªã„ã®â€¦æ™®é€šã«ã‚‚ã£ãŸã„ãªã„ã‚ˆï¼Ÿ"
      ],
      steps: [
        "æ•£ã‚‰ã‹ã£ã¦ã‚‹ã®ç‰‡ã¥ã‘ã¦ã€‚ãã“ã‹ã‚‰ã€‚",
        "ã‚„ã‚‹ã“ã¨ã‚’1å€‹ã«çµžã£ã¦ã€‚æ¬²å¼µã‚‰ãªã„ã€‚",
        "çµ‚ã‚ã‚‰ã›ã¦ã‹ã‚‰ä¼‘ã‚“ã§ã€‚é€†ã«ã™ã‚‹ã¨ãšã£ã¨çµ‚ã‚ã‚‰ãªã„ã‚ˆã€‚"
      ]
    },
    "AIR_AIR": {
      one: [
        "é ­ã®ä¸­ã§æ‚©ã‚“ã§ã‚‹æ™‚é–“ã€ã‚³ã‚¹ãƒ‘æ‚ªã„ã‚ˆï¼Ÿæ›¸ã„ã¦ã€‚å‡ºã—ã¦ã€‚",
        "é€£çµ¡å¾Œå›žã—ã«ã—ã¦ã‚‹ï¼Ÿãã‚Œé‹è½ã¡ã‚‹ã‚„ã¤ã€‚çŸ­ãè¿”ã—ã¦ã€‚"
      ],
      steps: [
        "ãƒ¡ãƒ¢ã«ä¸€è¡Œæ›¸ã„ã¦ã€çŠ¶æ…‹ã‚’è¦‹ãˆã‚‹åŒ–ã—ã¦ã€‚",
        "é€£çµ¡ã¯çŸ­æ–‡ã§OKã€‚ã¨ã‚Šã‚ãˆãšå‡ºã—ã¦ã€‚",
        "â€œä»Šæ—¥ã‚„ã‚‰ãªã„ã“ã¨â€ã‚‚æ±ºã‚ã¦ã€‚"
      ]
    }
  }
};

function getTodayPack(ctx){
  const k = todayKey(ctx);
  const tone = ctx.toneKey;
  const base = POOLS[tone]?.[k]
    ?? POOLS[tone]?.["EARTH_EARTH"]
    ?? POOLS.soft["EARTH_EARTH"];
  return base;
}

export function buildTodayBonus(ctx){
  const pack = getTodayPack(ctx);
  const seedBase = `${ctx.dobStr}|${ctx.todayStr}|${ctx.typeKey}|${ctx.toneKey}`;

  const one = pickDeterministic(pack.one, `${seedBase}|ONE`);
  const steps = uniq3(pack.steps, `${seedBase}|STEPS`);

  return { one, steps };
}

/* =========================
  äººç”Ÿé‘‘å®šï¼ˆå…¬é–‹æœ¬æ–‡ï¼‰
  â€»å°‚é–€ç”¨èªžã¯å‡ºã•ãªã„ï¼šåˆå¿ƒè€…ãƒ»ä¸€èˆ¬å‘ã‘
========================= */
export function buildPublicText(ctx, todayBonus){
  const tonePack = TEXT_DB.tone[ctx.toneKey] ?? TEXT_DB.tone.normal;
  const type = TEXT_DB.types20[ctx.typeKey] ?? { name:"ãªãžã®ã‚¯ãƒž", desc:"ã‚¿ã‚¤ãƒ—æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€‚", tags:"-" };
  const name = ctx.name?.trim() ? ctx.name.trim() : "ã‚ãªãŸ";

  const lines = [];

  lines.push(`# ðŸ» ${type.name}`);
  lines.push(`${name}ã¯ã­ã€ã–ã£ãã‚Šè¨€ã†ã¨ã€Œ${type.desc}ã€ã£ã¦æ„Ÿã˜ã ã‚ˆã€‚`);
  lines.push("");

  lines.push(`## äººç”Ÿã®æµã‚Œï¼ˆã“ã‚Œã‹ã‚‰ï¼‰`);
  if (ctx.toneKey === "soft"){
    lines.push(`ã‚ãªãŸã¯ã­ã€ç„¦ã£ã¦ä¸€æ°—ã«å¤‰ãˆã‚‹ã‚ˆã‚Šã€ã¡ã‚ƒã‚“ã¨ç©ã¿ä¸Šã’ã¦å¾Œã‹ã‚‰å›žåŽã™ã‚‹ã‚¿ã‚¤ãƒ—ã ã‚ˆã€‚ã‚†ã£ãã‚Šã§å¤§ä¸ˆå¤«ã€‚`);
    lines.push(`å®‰å¿ƒã§ãã‚‹åœŸå°ï¼ˆç”Ÿæ´»ãƒ»ä»•äº‹ã®åž‹ï¼‰ã‚’ä½œã‚‹ã»ã©ã€é‹ãŒã¶ã‚Œã«ãããªã‚‹ã‚ˆã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`ã‚ãªãŸã¯â€œä¸€ç™ºé€†è»¢â€ã‚ˆã‚Šã€ç©ã¿ä¸Šã’ã§å‹ã¤ã‚¿ã‚¤ãƒ—ã€‚ãªã®ã«æ­¢ã¾ã£ãŸã‚‰ã€ãŸã æã ã‚ˆï¼Ÿ`);
    lines.push(`æœªæ¥ã‚’è‰¯ãã—ãŸã„ãªã‚‰ã€â€œã‚„ã‚ãªã„ä»•çµ„ã¿â€ä½œã‚Šãªã€‚ãã“ãŒå‹ã¡ç­‹ã€‚`);
  } else {
    lines.push(`ç©ã¿ä¸Šã’åž‹ã§ã€å¾Œã‹ã‚‰å›žåŽã—ã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã€‚åœŸå°ã¥ãã‚ŠãŒé‹ã‚’å¼·ãã™ã‚‹ã€‚`);
    lines.push(`æ´¾æ‰‹ã•ã‚ˆã‚Šç¶™ç¶šãŒåŠ¹ãã€‚åž‹ã‚’ä½œã‚‹ã¨ä¼¸ã³ãŒå®‰å®šã™ã‚‹ã€‚`);
  }
  lines.push("");

  lines.push(`## ä»•äº‹`);
  if (ctx.toneKey === "soft"){
    lines.push(`ã‚ãªãŸã®ä»•äº‹é‹ã¯ã­ã€â€œè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ç©ã‚“ã ã‚‚ã®â€ãŒã¡ã‚ƒã‚“ã¨ä¾¡å€¤ã«ãªã‚‹ã‚ˆã€‚ç„¦ã‚‰ãªãã¦ã„ã„ã®ã€‚`);
    lines.push(`å°ã•ãå‡ºã—ã¦ã€ã‚ã¨ã§æ•´ãˆã‚‹ã€‚ãã‚ŒãŒã„ã¡ã°ã‚“å¼·ã„ã‚ˆã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`ä»•äº‹ã¯â€œå‡ºã—ãŸäººâ€ãŒå‹ã¤ã®ã€‚å®Œç’§ã«ã—ã¦ã‹ã‚‰ï¼Ÿãã®é–“ã«ç½®ã„ã¦ã‹ã‚Œã‚‹ã‚ˆã€‚`);
    lines.push(`å°ã•ãå‡ºã—ã¦å›žã—ã¦ã€‚ã¾ãšå‹•ã„ã¦ã€‚`);
  } else {
    lines.push(`ä»•äº‹ã¯ã€Œå°ã•ãå‡ºã—ã¦å›žã™ã€ãŒå¼·ã„ã€‚ç¶™ç¶šã¨ãƒ†ãƒ³ãƒ—ãƒ¬åŒ–ãŒæ­¦å™¨ã€‚`);
    lines.push(`ç©ã¿ä¸Šã’ãŒè©•ä¾¡ã«ã¤ãªãŒã‚Šã‚„ã™ã„ã€‚`);
  }
  lines.push("");

  lines.push(`## ãŠé‡‘`);
  if (ctx.toneKey === "soft"){
    lines.push(`ãŠé‡‘ã¯ã­ã€å®‰å¿ƒã®åœŸå°ã ã‚ˆã€‚ã‚ãªãŸã¯â€œãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚‹ã»ã©â€å®ˆã‚‰ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã€‚`);
    lines.push(`å›ºå®šè²»ã‚„ä»•çµ„ã¿ã§æ•´ãˆã‚‹ã¨ã€æ°—æŒã¡ãŒã™ã”ããƒ©ã‚¯ã«ãªã‚‹ã‚ˆã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`ãŠé‡‘ã®ä¸å®‰ã£ã¦ã€è¦‹ãªã„ã‹ã‚‰å¢—ãˆã‚‹ã®ã€‚æ•°å­—ã‹ã‚‰é€ƒã’ãªã„ã§ã€‚`);
    lines.push(`å›ºå®šè²»ã‹ãƒ«ãƒ¼ãƒ«ã€ã©ã£ã¡ã‹1å€‹æ•´ãˆã¦ã€‚ã™ãè½ã¡ç€ãã‹ã‚‰ã€‚`);
  } else {
    lines.push(`ãŠé‡‘ã¯ãƒ«ãƒ¼ãƒ«åŒ–ãŒåŠ¹ãã€‚å›ºå®šè²»ãƒ»ä»•çµ„ã¿ã§å®‰å®šã—ã‚„ã™ã„ã€‚`);
    lines.push(`å®ˆã‚Šã‚’å›ºã‚ã‚‹ã»ã©å¢—ã‚„ã—ã‚„ã™ã„ã€‚`);
  }
  lines.push("");

  lines.push(`## æ‹æ„›`);
  if (ctx.toneKey === "soft"){
    lines.push(`æ‹æ„›ã¯ã­ã€ã‚ãªãŸãŒå®‰å¿ƒã§ãã‚‹ç›¸æ‰‹ã»ã©ä¸Šæ‰‹ãã„ãã‚ˆã€‚ç„¡ç†ã—ã¦ç››ã‚Šä¸Šã’ãªãã¦ã„ã„ã®ã€‚`);
    lines.push(`ä¼šè©±ãŒè‡ªç„¶ã«ç¶šãäººã€ã‚ãªãŸã‚’æ€¥ã‹ã•ãªã„äººãŒç›¸æ€§ã„ã„ã‚ˆã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`é›‘ã«æ‰±ã†äººã«æ™‚é–“ã‚ã’ãªã„ã§ã€‚ã‚‚ã£ãŸã„ãªã„ã‹ã‚‰ã€‚`);
    lines.push(`è¨€è‘‰ã˜ã‚ƒãªãã¦ã€è¡Œå‹•ãŒä¸å¯§ãªäººã‚’é¸ã‚“ã§ã­ã€‚`);
  } else {
    lines.push(`æ‹æ„›ã¯ä¼šè©±ã®æ°—æŒã¡ã‚ˆã•ãŒéµã€‚ç„¡ç†ã—ãªã„ç›¸æ‰‹ãŒå½“ãŸã‚Šã€‚`);
    lines.push(`ç”Ÿæ´»ãƒšãƒ¼ã‚¹ãŒåˆã†äººã»ã©é•·ç¶šãã—ã‚„ã™ã„ã€‚`);
  }
  lines.push("");

  lines.push(`## å¥åº·`);
  if (ctx.toneKey === "soft"){
    lines.push(`ã‚ãªãŸã¯ã­ã€é ‘å¼µã‚Šã™ãŽã‚‹ã¨ä½“ãŒå…ˆã«æ•™ãˆã¦ãã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã€‚ã ã‹ã‚‰ä¼‘ã‚€ã®ã‚‚æ‰èƒ½ã ã‚ˆã€‚`);
    lines.push(`ç¡çœ ã‚’æ•´ãˆã‚‹ã ã‘ã§ã€é‹ã‚‚å®‰å®šã—ã‚„ã™ã„ã‚ˆã€‚`);
  } else if (ctx.toneKey === "spicy"){
    lines.push(`å¯ãªã„ã§å´©ã‚Œã¦ã€Œæ™‚é–“ãªã„ã€ã£ã¦è¨€ã†ã®ã€æœ€æ‚ªã®ãƒ«ãƒ¼ãƒ—ã€‚è‡ªåˆ†ã®æ‰±ã„é›‘ã™ãŽã€‚`);
    lines.push(`å›žå¾©ã§ãã‚‹ä½“ã«ã—ã¦ã€‚ãã“ã‹ã‚‰å…¨éƒ¨å¤‰ã‚ã‚‹ã‹ã‚‰ã€‚`);
  } else {
    lines.push(`å¥åº·ã¯ç¡çœ ã¨é£Ÿäº‹ãŒãƒ™ãƒ¼ã‚¹ã€‚å›žå¾©ã‚’å„ªå…ˆã™ã‚‹ã¨å®‰å®šã™ã‚‹ã€‚`);
    lines.push(`ç„¡ç†ã‚’æºœã‚ãªã„è¨­è¨ˆãŒé‡è¦ã€‚`);
  }
  lines.push("");

  lines.push(tonePack.header);
  lines.push(tonePack.closer);
  lines.push("");

  lines.push(`---`);
  lines.push(`## ä»Šæ—¥ã®ãŠã¾ã‘ï¼ˆã²ã¨ã“ã¨ï¼‰`);
  lines.push(todayBonus.one);

  return lines.join("\n");
}
