<!-- Version: 5 / 2026-01-04
  ============================================================
  âœ… ç›®çš„ï¼šæœ¬æ–‡ã®ã€Œé€šã‚Šæ•°ã€ã‚’ä¸€æ°—ã«å¢—ã‚„ã™ï¼ˆA/B/Cå›ºå®šã‚’å»ƒæ­¢ï¼‰
  âœ… æ–¹é‡ï¼šæ–‡ç« ã‚’ã€Œéƒ¨å“åŒ–ã€ã—ã¦ã€æ¡ä»¶ã§ãƒŸãƒƒã‚¯ã‚¹ã—ã¦å‡ºåŠ›ã™ã‚‹

  â–¼ åˆå¿ƒè€…ãŒè§¦ã£ã¦OKï¼ˆã“ã“ã ã‘ï¼‰
  1) CONFIGï¼šå‡ºã™è¡Œæ•°ãƒ»ãƒ©ãƒ³ãƒ€ãƒ ã®æŒ™å‹•
  2) TEXT_DBï¼š
     - TYPE_20ï¼š20ã‚¿ã‚¤ãƒ—ã®åå‰ã¨èª¬æ˜
     - POOLSï¼šå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ–‡ç« å€™è£œï¼ˆã“ã“ã‚’å¢—ã‚„ã™ã»ã©é€šã‚Šæ•°ãŒçˆ†å¢—ï¼‰
     - TRAITSï¼šæ˜Ÿåº§/æ•°ç§˜/å‡ºç”Ÿæ™‚é–“ã®â€œã‚‰ã—ã•â€æ–‡ï¼ˆã“ã“ã‚‚å¢—ã‚„ã›ã‚‹ï¼‰
     - tonesï¼šã‚„ã•ã—ã‚/æ¨™æº–/æ¯’èˆŒã®å£èª¿

  â–¼ é€šã‚Šæ•°ã®å¢—ãˆæ–¹ï¼ˆã–ã£ãã‚Šï¼‰
  - å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§3è¡ŒÃ—8ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼24è¡Œã‚’ã€å€™è£œã‹ã‚‰æŠ½é¸
  - å€™è£œãŒå¢—ãˆã‚‹ã»ã©æŒ‡æ•°çš„ã«å¢—ãˆã‚‹ï¼ˆã»ã¼ç„¡é™ã«è¿‘ã¥ãï¼‰

  â–¼ ä»•æ§˜
  - å‡ºç”Ÿåœ°/å‡ºç”Ÿæ™‚é–“ã¯æœ¬æ–‡ã«è¡¨ç¤ºã¯ã™ã‚‹ï¼ˆCONFIGã§OFFå¯ï¼‰
  - ä»Šã¯ã€Œå‡ºç”Ÿåœ°ã¯è¡¨ç¤ºã®ã¿ã€ã€‚å¾Œã§ãƒ­ã‚¸ãƒƒã‚¯ã«çµ„ã¿è¾¼ã¿ã‚„ã™ã„å½¢ã«ã—ã¦ã‚ã‚‹

  ============================================================
-->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã‚¯ãƒå ã„</title>

  <style>
    :root{
      --bg:#0b0b10;
      --panel:#11111a;
      --text:#f3f3f7;
      --muted:rgba(243,243,247,.72);
      --line:rgba(255,255,255,.12);
      --accent:#8ab4ff;
      --radius:14px;
      --pad:16px;
      --gap:12px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --max:980px;
      --font:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",sans-serif;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Noto Sans Mono",monospace;
    }
    *,*::before,*::after{ box-sizing:border-box; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 15% 0%, rgba(138,180,255,.18), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(255,140,180,.12), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:var(--font);
      line-height:1.7;
    }
    .wrap{ max-width:var(--max); margin:0 auto; padding:24px; }
    header{ display:flex; flex-direction:column; gap:6px; margin-bottom:16px; }
    h1{ font-size:20px; margin:0; }
    .sub{ margin:0; color:var(--muted); font-size:13px; }

    .grid{ display:grid; grid-template-columns:1fr; gap:var(--gap); align-items:start; }
    @media (min-width:900px){ .grid{ grid-template-columns:360px 1fr; } }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), transparent 42%), var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:var(--pad);
      box-shadow:var(--shadow);
    }

    .sectionTitle{ font-size:13px; color:var(--muted); margin:0 0 10px; letter-spacing:.02em; }

    label{ display:block; font-size:12px; color:var(--muted); margin:10px 0 6px; }
    input,select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input::placeholder{ color:rgba(255,255,255,.35); }

    .row2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:560px){ .row2{ grid-template-columns:1fr; } .wrap{ padding:16px; } }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-size:14px;
    }
    button.primary{
      background:var(--accent);
      border-color:transparent;
      color:#09101d;
      font-weight:800;
    }
    button:active{ transform:translateY(1px); }

    .pill{
      display:inline-block;
      padding:4px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      margin-right:6px;
      background:rgba(255,255,255,.03);
    }
    .mini{ font-size:12px; color:var(--muted); }

    .typeBox{
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:12px;
      background:rgba(255,255,255,.03);
      margin-top:10px;
    }
    .typeTitle{ font-weight:900; font-size:16px; margin:0 0 6px; }
    .typeDesc{ margin:0; color:var(--muted); font-size:13px; }
    .typeMeta{ margin-top:8px; color:var(--muted); font-size:12px; }

    textarea{
      width:100%;
      min-height:520px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:12px;
      font-family:var(--mono);
      font-size:13px;
      white-space:pre-wrap;
      line-height:1.65;
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <h1>ã‚¯ãƒå ã„</h1>
    <p class="sub">ã‚¿ã‚¤ãƒ—å®£è¨€ â†’ è©³ç´°é‘‘å®šï¼ˆãƒœã‚¿ãƒ³1å›ï¼‰</p>
  </header>

  <div class="grid">
    <div class="card">
      <p class="sectionTitle">å…¥åŠ›</p>

      <label>åå‰</label>
      <input id="name" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" />

      <label>ç”Ÿå¹´æœˆæ—¥</label>
      <input id="dob" type="date" />

      <div class="row2">
        <div>
          <label>å‡ºç”Ÿåœ°</label>
          <select id="place"></select>
        </div>
        <div>
          <label>å‡ºç”Ÿæ™‚é–“</label>
          <select id="time"></select>
        </div>
      </div>

      <label>é‘‘å®šã‚¹ã‚¿ã‚¤ãƒ«</label>
      <select id="tone">
        <option value="soft">ã‚„ã•ã—ã‚</option>
        <option value="normal" selected>æ¨™æº–</option>
        <option value="spicy">æ¯’èˆŒ</option>
      </select>

      <div class="btns">
        <button class="primary" id="gen">ç”Ÿæˆ</button>
        <button id="copy">ã‚³ãƒ”ãƒ¼</button>
        <button id="clear">ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <div class="card" id="outputCard">
      <p class="sectionTitle">çµæœ</p>

      <div class="mini">
        <span class="pill">æ˜Ÿåº§</span><span id="badgeSign">-</span>
        <span class="pill">æ•°ç§˜</span><span id="badgeLP">-</span>
        <span class="pill">å¹´é½¢</span><span id="badgeAge">-</span>
      </div>

      <div class="typeBox">
        <p class="typeTitle" id="typeTitle">ã‚¿ã‚¤ãƒ—ï¼š-</p>
        <p class="typeDesc" id="typeDesc">ç”Ÿå¹´æœˆæ—¥ã‚’å…¥ã‚Œã¦ã€Œç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚</p>
        <div class="typeMeta" id="typeMeta">-</div>
      </div>

      <label style="margin-top:12px;">é‘‘å®šæ–‡</label>
      <textarea id="out" readonly></textarea>
    </div>
  </div>
</div>

<script>
/* =========================================================
  âœ… CONFIGï¼šé€šã‚Šæ•°ã‚’å¢—ã‚„ã™ãªã‚‰ã¾ãšã“ã“
========================================================= */
const CONFIG = {
  // ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †
  sections: ["social","overall","work","money","health","love","turning","final"],

  // å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ä½•è¡Œå‡ºã™ï¼Ÿï¼ˆå¢—ã‚„ã™ã»ã©æ¿ƒããªã‚‹ï¼‰
  linesPerSection: 3,

  // åŒã˜å…¥åŠ›ãªã‚‰åŒã˜çµæœã«ã™ã‚‹ï¼Ÿï¼ˆå ã„ã£ã½ã•UPï¼‰
  deterministic: true,

  // æœ¬æ–‡ã«å‡ºç”Ÿåœ°/å‡ºç”Ÿæ™‚é–“ã‚’å‡ºã™ã‹
  showMeta: true,

  // typeKeyè¡¨ç¤ºï¼ˆã‚¤ãƒ©ã‚¹ãƒˆé‹ç”¨ã®ãŸã‚ï¼‰
  showTypeKeyInUI: true,
  showTypeKeyInText: true,
};

/* =========================================================
  âœ… TEXT_DBï¼šé€šã‚Šæ•°ã®ã€Œç‡ƒæ–™ã€
  - POOLS ã®å€™è£œã‚’å¢—ã‚„ã™ã»ã©æœ¬æ–‡ãŒã©ã‚“ã©ã‚“å¤šæ§˜ã«ãªã‚‹
========================================================= */
const TEXT_DB = {
  tones: {
    soft: {
      header: "ä»Šæ—¥ã¯ã‚ãªãŸã®è‰¯ã•ã¨å¯èƒ½æ€§ã«å…‰ã‚’å½“ã¦ã¦ã€ã‚„ã•ã—ãèª­ã¿è§£ã„ã¦ã„ãã­ã€‚",
      footer: "ç„¦ã‚‰ãªãã¦å¤§ä¸ˆå¤«ã€‚å°ã•ãªä¸€æ­©ã‚’ç©ã¿é‡ã­ã‚‹ã»ã©ã€é‹ã¯ã‚ãªãŸã®å‘³æ–¹ã«ãªã£ã¦ã„ãã‚ˆã€‚",
      wrap: (s) => `${stripPeriod(s)}ã€‚å¤§ä¸ˆå¤«ã€ã¡ã‚ƒã‚“ã¨é€²ã‚ã‚‹ã€‚`
    },
    normal: {
      header: "ã“ã®é‘‘å®šã¯ã€æ˜Ÿåº§ãƒ»æ•°ç§˜ãªã©ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹å‚¾å‘ã‚’å®¢è¦³çš„ã«ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚",
      footer: "é‹å‹¢ã¯åœ°å›³ã®ã‚ˆã†ãªã‚‚ã®ã€‚é¸ã³æ–¹ã§ã€çµæœã¯ã„ãã‚‰ã§ã‚‚å¤‰ãˆã‚‰ã‚Œã¾ã™ã€‚",
      wrap: (s) => s
    },
    spicy: {
      header: "é æ…®ãªã—ã§è¨€ã†ã€‚ä¼¸ã³ã‚‹ãŸã‚ã«å¿…è¦ãªã“ã¨ã ã‘æ›¸ãã€‚",
      footer: "åˆºã•ã£ãŸãªã‚‰ä¼¸ã³ã—ã‚ã€‚ä»Šæ—¥ã‹ã‚‰ä¸€å€‹ã ã‘ç›´ã›ã°ã€é‹ã¯ä¸ŠãŒã‚‹ã€‚ã‚„ã‚‹ã‹ã©ã†ã‹ã¯ã‚ãªãŸæ¬¡ç¬¬ã€‚",
      wrap: (s) => `${stripPeriod(s)}ã€‚${pickOne([
        "â€¦ã§ã€ã„ã¤ã‚„ã‚‹ã®ï¼Ÿ",
        "è¨€ã„è¨³ã—ã¦ã‚‹æš‡ã‚ã‚‹ï¼Ÿ",
        "ã“ã“ã§æ­¢ã¾ã‚‹ã¨é‹ã‚‚æ­¢ã¾ã‚‹ã€‚",
        "ã‚„ã‚‹äººã ã‘ãŒå›åã™ã‚‹ã€‚"
      ])}`
    }
  },

  signs: {
    "å±±ç¾Šåº§": { vibe: "å …å®Ÿãƒ»é•·æœŸå¿—å‘ãƒ»ç©ã¿ä¸Šã’" },
    "æ°´ç“¶åº§": { vibe: "ç‹¬è‡ªæ€§ãƒ»æ”¹é©ãƒ»ç™ºæƒ³" },
    "é­šåº§":   { vibe: "å…±æ„Ÿãƒ»æ„Ÿæ€§ãƒ»æµã‚Œ" },
    "ç‰¡ç¾Šåº§": { vibe: "å§‹å‹•ãƒ»ç›´æ„Ÿãƒ»çªç ´" },
    "ç‰¡ç‰›åº§": { vibe: "å®‰å®šãƒ»ä¾¡å€¤ãƒ»æŒä¹…åŠ›" },
    "åŒå­åº§": { vibe: "æƒ…å ±ãƒ»æ‹¡æ•£ãƒ»æŸ”è»Ÿ" },
    "èŸ¹åº§":   { vibe: "å®ˆã‚‹ãƒ»è‚²ã¦ã‚‹ãƒ»ã¤ãªãŒã‚Š" },
    "ç…å­åº§": { vibe: "è¡¨ç¾ãƒ»è‡ªä¿¡ãƒ»ä¸­å¿ƒ" },
    "ä¹™å¥³åº§": { vibe: "æ•´ç†ãƒ»æ”¹å–„ãƒ»å®Ÿå‹™" },
    "å¤©ç§¤åº§": { vibe: "èª¿å’Œãƒ»ç¾æ„è­˜ãƒ»äº¤æ¸‰" },
    "è åº§":   { vibe: "é›†ä¸­ãƒ»æ·±æ˜ã‚Šãƒ»æœ¬è³ª" },
    "å°„æ‰‹åº§": { vibe: "å†’é™ºãƒ»æ‹¡å¤§ãƒ»æ¢ç©¶" },
  },
  lifepath: {
    1:"å§‹å‹•ã¨è‡ªå·±æ±ºå®š", 2:"å”èª¿ã¨èª¿æ•´", 3:"è¡¨ç¾ã¨ç™ºä¿¡",
    4:"åŸºç›¤ã¨ç¶™ç¶š", 5:"å¤‰åŒ–ã¨æŒ‘æˆ¦", 6:"æ„›æƒ…ã¨è²¬ä»»",
    7:"æ¢æ±‚ã¨å†…çœ", 8:"é”æˆã¨æ‹¡å¤§", 9:"å®Œæˆã¨å¾ªç’°"
  },

  // å¯æ„›ã„20ã‚¿ã‚¤ãƒ—ï¼ˆãã®ã¾ã¾æµç”¨ï¼‰
  TYPE_20: {
    "FIRE_1":  { name:"ã»ã‹ã»ã‹è¦‹å®ˆã‚Šã‚°ãƒ", desc:"ã‚ã£ãŸã‹ãå®ˆã‚Šã¤ã¤ã€åœŸå°ã‚’ã‚³ãƒ„ã‚³ãƒ„å›ºã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚", tags:"ç«Ã—å®‰å®š" },
    "FIRE_2":  { name:"ãƒ¡ãƒ©ãƒ¡ãƒ©ç·´ç¿’ã‚°ãƒ",   desc:"ä¼¸ã³ã‚‹ãŸã‚ã®åå¾©ãŒå¾—æ„ã€‚å°ã•ãªæ”¹å–„ã§å¼·ããªã‚‹ã€‚", tags:"ç«Ã—ä¼¸é•·" },
    "FIRE_3":  { name:"ãƒ‰ãƒƒã‚«ãƒ³çªæ’ƒã‚°ãƒ",   desc:"è¿·ã†ã‚ˆã‚Šå…ˆã«ä¸€æ­©ã€‚å‹•ã„ãŸç¬é–“ã‹ã‚‰æµã‚ŒãŒå¤‰ã‚ã‚‹ã€‚", tags:"ç«Ã—æŒ‘æˆ¦" },
    "FIRE_4":  { name:"ã²ã‚‰ã‚ãå†’é™ºã‚°ãƒ",   desc:"å¥½å¥‡å¿ƒãŒç‡ƒæ–™ã€‚é¢ç™½ã„æ–¹ã¸é€²ã‚€ã»ã©é‹ãŒé–‹ãã€‚", tags:"ç«Ã—æ¢æ±‚" },
    "FIRE_5":  { name:"ã”ã»ã†ã³é”æˆã‚°ãƒ",   desc:"æœ€å¾Œã«ã—ã£ã‹ã‚Šå›åã™ã‚‹ã€‚ç©ã¿ä¸Šã’ã®å®Œèµ°ãŒå¾—æ„ã€‚", tags:"ç«Ã—å®Œæˆ" },

    "EARTH_1": { name:"ã‚‚ãµã‚‚ãµåŸºç¤ã‚°ãƒ",   desc:"ã¾ãšæ•´ãˆã‚‹ã€‚åœŸå°ãŒã§ãã‚‹ã¨ä¸€æ°—ã«å®‰å®šã™ã‚‹ã€‚", tags:"åœ°Ã—å®‰å®š" },
    "EARTH_2": { name:"ã‚³ãƒ„ã‚³ãƒ„è·äººã‚°ãƒ",   desc:"æ¯æ—¥å°‘ã—ãšã¤å¼·ããªã‚‹ã€‚ç¶™ç¶šãŒæœ€å¤§ã®æ­¦å™¨ã€‚", tags:"åœ°Ã—ä¼¸é•·" },
    "EARTH_3": { name:"ç¾å®Ÿã¤ã‚ˆã¤ã‚ˆã‚°ãƒ",   desc:"æŒ‘æˆ¦ã‚‚ç¾å®Ÿçš„ã«é€²ã‚ã‚‹ã€‚å‹ã¡ç­‹ã‚’ä½œã£ã¦æ”»ã‚ã‚‹ã€‚", tags:"åœ°Ã—æŒ‘æˆ¦" },
    "EARTH_4": { name:"é»™ã€…ç ”ç©¶ã‚°ãƒ",       desc:"æ·±æ˜ã‚Šã—ã¦ç²¾åº¦ã‚’ä¸Šã’ã‚‹ã»ã©è©•ä¾¡ãŒä¸ŠãŒã‚‹ã€‚", tags:"åœ°Ã—æ¢æ±‚" },
    "EARTH_5": { name:"æ•´ãˆå®Œäº†ã‚°ãƒ",       desc:"ç‰‡ä»˜ã‘ãƒ»æ•´ç†ãƒ»æ±ºç€ãŒå¾—æ„ã€‚çµ‚ã‚ã‚‰ã›ã¦æ¬¡ã¸è¡Œã‘ã‚‹ã€‚", tags:"åœ°Ã—å®Œæˆ" },

    "AIR_1":   { name:"ãµã‚ã£ã¨èª¿æ•´ã‚°ãƒ",   desc:"ç©ºæ°—ã‚’èª­ã‚“ã§æ•´ãˆã‚‹ã€‚ç„¡ç†ãªãå®‰å®šã•ã›ã‚‹ã®ãŒä¸Šæ‰‹ã€‚", tags:"é¢¨Ã—å®‰å®š" },
    "AIR_2":   { name:"ãŠã—ã‚ƒã¹ã‚Šæˆé•·ã‚°ãƒ", desc:"è¨€è‘‰ã¨æƒ…å ±ã§ä¼¸ã³ã‚‹ã€‚ç™ºä¿¡ã™ã‚‹ã¨åŠ é€Ÿã™ã‚‹ã€‚", tags:"é¢¨Ã—ä¼¸é•·" },
    "AIR_3":   { name:"ã‚¹ãƒ”ãƒ¼ãƒ‰è»¢èº«ã‚°ãƒ",   desc:"åˆ‡ã‚Šæ›¿ãˆãŒæ—©ã„ã€‚æŒ‘æˆ¦ã®å›æ•°ãŒæœªæ¥ã‚’ä½œã‚‹ã€‚", tags:"é¢¨Ã—æŒ‘æˆ¦" },
    "AIR_4":   { name:"ã‚¢ã‚¤ãƒ‡ã‚¢é£›è¡Œã‚°ãƒ",   desc:"ã²ã‚‰ã‚ãã‚’æ‹¾ã†å¤©æ‰ã€‚åºƒã’ã¦ã‹ã‚‰çµã‚‹ã¨å¼·ã„ã€‚", tags:"é¢¨Ã—æ¢æ±‚" },
    "AIR_5":   { name:"è¨€èªåŒ–ã¾ã¨ã‚ã‚°ãƒ",   desc:"æ•£ã‚‰ã°ã£ãŸã‚‚ã®ã‚’ã¾ã¨ã‚ã¦å®Œæˆã•ã›ã‚‹ã®ãŒå¾—æ„ã€‚", tags:"é¢¨Ã—å®Œæˆ" },

    "WATER_1": { name:"ã—ã£ã¨ã‚Šå®‰å¿ƒã‚°ãƒ",   desc:"å±…å ´æ‰€ã‚’ä½œã‚‹ã¨å¼·ã„ã€‚äººé–“é–¢ä¿‚ãŒé‹ã®åœŸå°ã«ãªã‚‹ã€‚", tags:"æ°´Ã—å®‰å®š" },
    "WATER_2": { name:"ã˜ã‚ã˜ã‚è‚²æˆã‚°ãƒ",   desc:"ã‚†ã£ãã‚Šç¢ºå®Ÿã«ä¼¸ã³ã‚‹ã€‚è‚²ã¦ãŸã‚‚ã®ãŒè²¡ç”£ã«ãªã‚‹ã€‚", tags:"æ°´Ã—ä¼¸é•·" },
    "WATER_3": { name:"è¦šæ‚Ÿã‚¬ãƒæ‹ã‚°ãƒ",     desc:"æœ¬æ°—ã‚’æ±ºã‚ãŸã‚‰å¼·ã„ã€‚æƒ…ç†±ãŒè¡Œå‹•ã«å¤‰ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚", tags:"æ°´Ã—æŒ‘æˆ¦" },
    "WATER_4": { name:"æ·±æµ·èª­ã¿è§£ãã‚°ãƒ",   desc:"æœ¬è³ªã‚’è¦‹æŠœãã€‚æ·±ãè€ƒãˆã‚‹ã»ã©ç­”ãˆãŒå‡ºã‚‹ã€‚", tags:"æ°´Ã—æ¢æ±‚" },
    "WATER_5": { name:"æµ„åŒ–ãƒªã‚»ãƒƒãƒˆã‚°ãƒ",   desc:"æ‰‹æ”¾ã—ã¦æ•´ãˆã‚‹ã¨ä¸€æ®µä¸Šã¸ã€‚åŒºåˆ‡ã‚ŠãŒé–‹é‹ã«ãªã‚‹ã€‚", tags:"æ°´Ã—å®Œæˆ" },
  },

  // æ˜Ÿåº§/æ•°ç§˜/å‡ºç”Ÿæ™‚é–“ãŒæœ¬æ–‡ã«åˆºã•ã‚‹ã€Œè£œåŠ©æ–‡ã€ï¼ˆã“ã“å¢—ã‚„ã™ã¨ä¼¸ã³ã‚‹ï¼‰
  TRAITS: {
    signLines: {
      "å±±ç¾Šåº§":[ "é•·æœŸç›®ç·šã§ç©ã‚€ã»ã©å‹ã¡ã‚„ã™ã„", "ä¿¡ç”¨ã®ç©ã¿ä¸Šã’ãŒè©•ä¾¡ã«ç›´çµã™ã‚‹" ],
      "æ°´ç“¶åº§":[ "ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚‹ã¨ä¼¸ã³ã‚‹", "æ ã®å¤–ã®ç™ºæƒ³ãŒæ­¦å™¨ã«ãªã‚‹" ],
      "é­šåº§":[ "æ„Ÿæ€§ã®ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãŒé‹ã‚’å·¦å³ã™ã‚‹", "å…±æ„ŸåŠ›ãŒç¸ã¨ä»•äº‹ã‚’å¼•ãå¯„ã›ã‚‹" ],
      "ç‰¡ç¾Šåº§":[ "ã‚¹ã‚¿ãƒ¼ãƒˆã®é€Ÿã•ãŒé‹ã‚’ä½œã‚‹", "è¿·ã†ã‚ˆã‚Šè©¦ã™æ–¹ãŒæ—©ã„" ],
      "ç‰¡ç‰›åº§":[ "ç©ã¿ä¸Šã’ãŒè³‡ç”£ã«ãªã‚‹", "å¥½ããªã‚‚ã®ã‚’å®ˆã‚‹ã»ã©é‹ãŒå®‰å®šã™ã‚‹" ],
      "åŒå­åº§":[ "æƒ…å ±ã®å‡ºå…¥ã‚ŠãŒé‹ã®ã‚¨ãƒ³ã‚¸ãƒ³", "ç™ºä¿¡ã¨äº¤æµãŒãƒãƒ£ãƒ³ã‚¹ã‚’å¢—ã‚„ã™" ],
      "èŸ¹åº§":[ "å±…å ´æ‰€ãŒã§ãã‚‹ã¨ä¸€æ°—ã«å¼·ããªã‚‹", "å®ˆã‚‹å¯¾è±¡ãŒã‚ã‚‹ã»ã©ç²˜ã‚ŠãŒå‡ºã‚‹" ],
      "ç…å­åº§":[ "è¡¨ã«å‡ºã‚‹ã»ã©é‹ãŒå‹•ã", "èƒ¸ã‚’å¼µã‚‹ã¨ç¸ãŒé›†ã¾ã‚‹" ],
      "ä¹™å¥³åº§":[ "æ”¹å–„ãŒãã®ã¾ã¾æˆæœã«ãªã‚‹", "æ•´ç†ã¨æ‰‹é †ãŒé‹ã‚’ä¸Šã’ã‚‹" ],
      "å¤©ç§¤åº§":[ "äººé–“é–¢ä¿‚ã®è³ªãŒé‹ã«ç›´çµ", "é¸æŠè‚¢ã®æ•´ç†ãŒéµã«ãªã‚‹" ],
      "è åº§":[ "ä¸€ç‚¹é›†ä¸­ãŒå¼·ã„", "æ·±æ˜ã‚Šã—ãŸã‚‚ã®ãŒæ­¦å™¨ã«ãªã‚‹" ],
      "å°„æ‰‹åº§":[ "ä¸–ç•Œã‚’åºƒã’ã‚‹ã»ã©é‹ãŒå¼·ã„", "é ãã®åˆºæ¿€ãŒè»¢æ©Ÿã‚’é€£ã‚Œã¦ãã‚‹" ],
    },
    lpLines: {
      1:[ "ä¸»å°æ¨©ã‚’æ¡ã‚‹ã»ã©é‹ãŒä¸ŠãŒã‚‹", "æ±ºæ–­ã‚’å…ˆå»¶ã°ã—ã«ã—ãªã„ã®ãŒéµ" ],
      2:[ "èª¿æ•´å½¹ãŒè©•ä¾¡ã•ã‚Œã‚‹", "ç›¸æ‰‹ã®æ¸©åº¦æ„Ÿã‚’èª­ã‚€ã¨å‹ã¡ã‚„ã™ã„" ],
      3:[ "è¡¨ç¾ãŒé‹ã‚’å‘¼ã¶", "è¨€è‘‰ãƒ»ä½œå“ãƒ»ç™ºä¿¡ã§æµã‚ŒãŒå¤‰ã‚ã‚‹" ],
      4:[ "åŸºç›¤ã¥ãã‚ŠãŒæœ€å¼·", "ç¿’æ…£ã®å·®ãŒæœªæ¥ã®å·®ã«ãªã‚‹" ],
      5:[ "å¤‰åŒ–ãŒé–‹é‹", "æŒ‘æˆ¦ã®æ•°ã ã‘ãƒãƒ£ãƒ³ã‚¹ãŒå¢—ãˆã‚‹" ],
      6:[ "è²¬ä»»ã‚’å¼•ãå—ã‘ã‚‹ã¨å¼·ããªã‚‹", "äººã‚’å¤§åˆ‡ã«ã™ã‚‹ã¨é‹ãŒå®ˆã‚‰ã‚Œã‚‹" ],
      7:[ "é™ã‹ãªæ™‚é–“ãŒå¿…è¦", "æ·±ãè€ƒãˆã‚‹ã»ã©ç²¾åº¦ãŒä¸ŠãŒã‚‹" ],
      8:[ "æˆæœã‚’å–ã‚Šã«è¡Œã‘ã‚‹", "æ‹¡å¤§ã¨å›åã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¤§äº‹" ],
      9:[ "æ•´ç†ã¨æ‰‹æ”¾ã—ãŒè»¢æ©Ÿã«ãªã‚‹", "çµ‚ã‚ã‚‰ã›ã‚‹ã»ã©æ¬¡ãŒå…¥ã‚‹" ],
    },
    timeLines: {
      "ä¸æ˜":[ "æ™‚é–“ã¯ä¸æ˜ã§ã‚‚å¤§ä¸ˆå¤«ã€‚æµã‚Œã¯è¡Œå‹•ã§ä½œã‚Œã‚‹" ],
      "æ—©æœï¼ˆ5â€“8ï¼‰":[ "æœå‹ã®å‹•ããŒé‹ã®ä¼¸ã³ã«ç›´çµã—ã‚„ã™ã„" ],
      "åˆå‰ï¼ˆ8â€“12ï¼‰":[ "åˆå‰ä¸­ã«å‹è² ã‚’ç½®ãã¨æµã‚ŒãŒä½œã‚Šã‚„ã™ã„" ],
      "æ˜¼ï¼ˆ12â€“15ï¼‰":[ "åˆ‡ã‚Šæ›¿ãˆä¸Šæ‰‹ã€‚åˆå¾Œã®å†èµ·å‹•ãŒå¾—æ„" ],
      "å¤•æ–¹ï¼ˆ15â€“18ï¼‰":[ "ã¾ã¨ã‚åŠ›ãŒå‡ºã‚„ã™ã„ã€‚æ•´ãˆã¦çµ‚ãˆã‚‹ã¨é‹ãŒæ®‹ã‚‹" ],
      "å¤œï¼ˆ18â€“22ï¼‰":[ "å¤œã«é›†ä¸­ãŒä¹—ã‚Šã‚„ã™ã„ã€‚æ²¡é ­ã§ä¼¸ã³ã‚‹" ],
      "æ·±å¤œï¼ˆ22â€“5ï¼‰":[ "æ„Ÿæ€§ãŒå†´ãˆã‚„ã™ã„ã€‚é™ã‘ã•ãŒæ­¦å™¨ã«ãªã‚‹" ],
    }
  },

  // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã€Œæ–‡ç« å€™è£œãƒ—ãƒ¼ãƒ«ã€ï¼šã“ã“ã‚’å¢—ã‚„ã™ã»ã©çµæœãŒå¢—ãˆã‚‹
  POOLS: {
    social: [
      "ç¬¬ä¸€å°è±¡ã¯è½ã¡ç€ãã¨èª å®Ÿã•ãŒå‡ºã‚„ã™ã„",
      "ç›¸è«‡å½¹ã«ãªã‚Šã‚„ã™ãã€é ¼ã‚‰ã‚Œã‚„ã™ã„",
      "å°‘æ•°ç²¾é‹­ã®é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã¨é‹ãŒå®‰å®šã™ã‚‹",
      "ç„¡ç†ã«åˆã‚ã›ã™ãã‚‹ã¨ç–²ã‚Œã‚‹ã®ã§å¢ƒç•Œç·šã‚’ä½œã‚‹",
      "ä¿¡é ¼ã¯ã€å°ã•ãªç´„æŸã€ã®ç©ã¿é‡ã­ã§çˆ†ä¼¸ã³ã™ã‚‹",
      "è·é›¢ãŒç¸®ã‚€ã»ã©é¢å€’è¦‹ã®è‰¯ã•ãŒå‡ºã‚‹",
    ],
    overall: [
      "ç„¦ã£ã¦æ—©å›ã—ã™ã‚‹ã¨é€†ã«é å›ã‚Šã«ãªã‚Šã‚„ã™ã„",
      "åœŸå°ã‚’æ•´ãˆãŸç¬é–“ã«é‹ãŒä¸Šå‘ãã‚„ã™ã„",
      "äººç”Ÿã¯å¾ŒåŠã»ã©å›åãŒåŠ¹ãã‚„ã™ã„æµã‚Œ",
      "ã‚„ã‚‹ã“ã¨ã‚’æ¸›ã‚‰ã™ã¨ä¸€æ°—ã«é€²ã¿ã‚„ã™ã„",
      "è¿·ã£ãŸã‚‰ã€ç¶šã‘ã‚‰ã‚Œã‚‹æ–¹ã€ã‚’é¸ã¶ã¨å‹ã¡ã‚„ã™ã„",
      "ç’°å¢ƒã‚’å¤‰ãˆã‚‹ã¨é‹ã®ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã‚‹ã“ã¨ãŒã‚ã‚‹",
    ],
    work: [
      "ä¼ç”»ãƒ»è¡¨ç¾ãƒ»ç™ºä¿¡ã®è»¸ãŒä¼¸ã³ã‚„ã™ã„",
      "ä½œã£ãŸã‚‚ã®ã‚’è¦‹ã›ã‚‹ã»ã©ä»•äº‹é‹ãŒå‹•ã",
      "åŸºç¤ã®ç£¨ãè¾¼ã¿ãŒè©•ä¾¡ã«ç›´çµã™ã‚‹",
      "ã€ä¸€äººã§æŠ±ãˆã‚‹ã€ã‚ˆã‚Šã€ä»•çµ„ã¿åŒ–ã€ãŒéµ",
      "ç›®æ¨™ã‚’å°åˆ†ã‘ã«ã™ã‚‹ã¨æˆæœãŒå‡ºã‚„ã™ã„",
      "ä¿¡ç”¨è²¯é‡‘ãŒä»•äº‹ã®è‡ªç”±åº¦ã‚’ä¸Šã’ã‚‹",
    ],
    money: [
      "æ³¢ãŒã‚ã£ã¦ã‚‚å›åã™ã‚‹åŠ›ãŒã‚ã‚‹",
      "å›ºå®šè²»ã®æ•´ç†ãŒé‡‘é‹ã®åœŸå°ã«ãªã‚‹",
      "å®ˆã‚Šã‚’å›ºã‚ã‚‹ã»ã©æ”»ã‚ãŒé€šã‚‹",
      "åå…¥æºã‚’åˆ†ã‘ã‚‹ã»ã©å®‰å®šã—ã‚„ã™ã„",
      "ä¸€ç™ºç‹™ã„ã‚ˆã‚Šç©ã¿ä¸Šã’ã®æ–¹ãŒå‘ã",
      "ã€ä½¿ã†ç›®çš„ã€ãŒæ˜ç¢ºã ã¨ãŠé‡‘ãŒæ®‹ã‚Šã‚„ã™ã„",
    ],
    health: [
      "ç¡çœ ã®ä¹±ã‚ŒãŒé‹ã®è½ã¡è¾¼ã¿ã«ç›´çµã—ã‚„ã™ã„",
      "ä¼‘é¤Šã¯è´…æ²¢ã§ã¯ãªãé–‹é‹ã®æ¡ä»¶ã«ãªã‚Šã‚„ã™ã„",
      "å‘¼å¸ãŒæµ…ã„ã¨åˆ¤æ–­ãŒéˆã‚Šã‚„ã™ã„ã®ã§æ„è­˜ã™ã‚‹ã¨è‰¯ã„",
      "é£Ÿäº‹ã®æ™‚é–“ãŒã‚ºãƒ¬ã‚‹ã¨ä½“èª¿ãŒãƒ–ãƒ¬ã‚„ã™ã„",
      "è»½ã„é‹å‹•ã®ç¶™ç¶šãŒä¸€ç•ªåŠ¹ã",
      "ã‚¹ãƒˆãƒ¬ã‚¹ã¯æºœã‚ã‚‹å‰ã«å°å‡ºã—ãŒæ­£è§£",
    ],
    love: [
      "æ‹æ„›ã¯ç”Ÿæ´»ã®å»¶é•·ç·šã§å‹•ãã‚„ã™ã„",
      "èª å®Ÿã•ãŒä¼ã‚ã‚‹ã»ã©ç¸ãŒæ¿ƒããªã‚‹",
      "å‹¢ã„ã‚ˆã‚Šç›¸æ€§ã®ã€ç¾å®Ÿé¢ã€ãŒé‡è¦ã«ãªã‚Šã‚„ã™ã„",
      "å®‰å¿ƒã§ãã‚‹ç›¸æ‰‹ã»ã©é‹ãŒè‚²ã¤",
      "ç›¸æ‰‹ã«åˆã‚ã›ã™ããªã„æ–¹ãŒé•·ç¶šãã™ã‚‹",
      "å‡ºä¼šã„ã¯è¡Œå‹•é‡ã«æ¯”ä¾‹ã—ã¦å¢—ãˆã‚„ã™ã„",
    ],
    turning: [
      "åŸºç¤ â†’ æ”¹å–„ â†’ æ‹¡å¼µ â†’ ä»•ä¸Šã’ã€ã®é †ã§å¼·ããªã‚‹",
      "ä¸€æ°—ã«å¤‰ãˆã‚‹ã‚ˆã‚Šç©ã‚“ã§åŠ¹ã‹ã›ã‚‹æ–¹ãŒå‹ã¡ã‚„ã™ã„",
      "ã€ã‚„ã‚ã‚‹æ±ºæ–­ã€ãŒè»¢æ©Ÿã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹",
      "ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯æº–å‚™é‡ã§å¼•ãå¯„ã›ã‚‰ã‚Œã‚‹",
      "æ•´ç†ã™ã‚‹ã¨æµã‚ŒãŒæˆ»ã£ã¦ãã‚‹",
      "ã¾ãš1ã¤çµ‚ã‚ã‚‰ã›ã‚‹ã¨æ¬¡ãŒå‹•ã",
    ],
    final: [
      "é™ã‹ã«ç©ã¿ä¸Šã’ã¦ã€å¾ŒåŠã§å¤§ããå ±ã‚ã‚Œã‚„ã™ã„",
      "è‡ªåˆ†ã®è»¸ã‚’æŒã¤ã»ã©é‹ãŒå®‰å®šã—ã¦å¼·ããªã‚‹",
      "ã€ç¶™ç¶šã§ãã‚‹å½¢ã€ã‚’ä½œã£ãŸäººãŒæœ€å¾Œã«å‹ã¤",
      "é å›ã‚Šã§ã‚‚ä¸€ç•ªç¢ºå®Ÿãªé“ã‚’å–ã‚Œã‚‹ã‚¿ã‚¤ãƒ—",
      "è‡ªåˆ†ã®ä¸–ç•Œè¦³ã‚’å®ˆã‚‹ã»ã©è©•ä¾¡ãŒè‚²ã¤",
      "å°ã•ãªæˆåŠŸä½“é¨“ãŒé‹ã‚’åŠ é€Ÿã•ã›ã‚‹",
    ],
  },

  // typeKeyï¼ˆ20ã‚¿ã‚¤ãƒ—ï¼‰ã”ã¨ã«åˆºã•ã‚‹â€œè¿½åŠ æ–‡â€
  TYPE_LINES: {
    "FIRE_3":[ "å‹è² ã¯æ—©ã„æ–¹ãŒã„ã„ã€‚è€ƒãˆã‚‹å‰ã«ä¸€å›å‹•ãã¨é“ãŒé–‹ã", "ç†±é‡ã¯æ­¦å™¨ã€‚å†·ã‚ãªã„ã†ã¡ã«å½¢ã«ã™ã‚‹" ],
    "EARTH_2":[ "ç¶™ç¶šãŒæ‰èƒ½ã«ãªã‚‹ã‚¿ã‚¤ãƒ—ã€‚ç©ã‚“ã åˆ†ã ã‘è£åˆ‡ã‚‰ãªã„", "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³åŒ–ã™ã‚‹ã¨çˆ†é€Ÿã§å¼·ããªã‚‹" ],
    "AIR_4":[ "ã‚¢ã‚¤ãƒ‡ã‚¢ã¯ãƒ¡ãƒ¢ã—ãªã„ã¨æ¶ˆãˆã‚‹ã€‚æ•ã¾ãˆãŸã‚‰å‹ã¡", "åºƒã’ã¦ã‹ã‚‰çµã‚‹ã¨ä¸€æ°—ã«å®Œæˆã«è¿‘ã¥ã" ],
    "WATER_5":[ "çµ‚ã‚ã‚‰ã›ã‚‹ã»ã©é‹ãŒå…¥ã‚‹ã€‚æ‰‹æ”¾ã—ã¯å‰é€²", "åŒºåˆ‡ã‚Šã‚’ä½œã‚‹ã¨ä¸€æ®µä¸ŠãŒã‚‹" ],
    // ä»–ã®typeKeyã‚‚å¢—ã‚„ã™ã¨ã•ã‚‰ã«é€šã‚Šæ•°UP
  }
};

/* =========================================================
  UIåˆæœŸåŒ–ï¼ˆå‡ºç”Ÿåœ°ãƒ»å‡ºç”Ÿæ™‚é–“ï¼‰
========================================================= */
const PREFECTURES = [
  "éƒ½é“åºœçœŒ",
  "åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ",
  "èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ",
  "æ–°æ½ŸçœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ",
  "å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ","ä¸‰é‡çœŒ",
  "æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ",
  "é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ",
  "å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ",
  "ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ"
];
const TIME_BLOCKS = [
  "ä¸æ˜",
  "æ—©æœï¼ˆ5â€“8ï¼‰",
  "åˆå‰ï¼ˆ8â€“12ï¼‰",
  "æ˜¼ï¼ˆ12â€“15ï¼‰",
  "å¤•æ–¹ï¼ˆ15â€“18ï¼‰",
  "å¤œï¼ˆ18â€“22ï¼‰",
  "æ·±å¤œï¼ˆ22â€“5ï¼‰"
];
function initSelect(id, items){
  const el = document.getElementById(id);
  el.innerHTML = "";
  for (const s of items){
    const opt = document.createElement("option");
    opt.value = s;
    opt.textContent = s;
    el.appendChild(opt);
  }
}

/* =========================================================
  ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
========================================================= */
const $ = (id) => document.getElementById(id);
function pad2(n){ return String(n).padStart(2,"0"); }
function stripPeriod(s){ return s.replace(/ã€‚$/, ""); }

// ã‚·ãƒ¼ãƒ‰ä»˜ãä¹±æ•°ï¼ˆåŒã˜å…¥åŠ›ãªã‚‰åŒã˜çµæœã«ã™ã‚‹ï¼‰
function hashString(str){
  let h = 2166136261;
  for (let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function makeRng(seed){
  let x = seed >>> 0;
  return function(){
    // xorshift32
    x ^= x << 13; x >>>= 0;
    x ^= x >> 17; x >>>= 0;
    x ^= x << 5;  x >>>= 0;
    return (x >>> 0) / 4294967296;
  };
}
function pickOne(arr, rng=Math.random){
  return arr[Math.floor(rng()*arr.length)];
}
function pickManyUnique(arr, n, rng=Math.random){
  const copy = arr.slice();
  const out = [];
  const k = Math.min(n, copy.length);
  for (let i=0;i<k;i++){
    const idx = Math.floor(rng()*copy.length);
    out.push(copy.splice(idx,1)[0]);
  }
  return out;
}

function calcLifePathNumber(dateObj){
  const s = `${dateObj.getFullYear()}${pad2(dateObj.getMonth()+1)}${pad2(dateObj.getDate())}`;
  let sum = 0;
  for (const ch of s) sum += Number(ch);
  while (sum > 9) sum = String(sum).split("").reduce((a,c)=>a+Number(c),0);
  return sum;
}
function calcAge(dateObj){
  const today = new Date();
  let age = today.getFullYear() - dateObj.getFullYear();
  const birthdayThisYear = new Date(today.getFullYear(), dateObj.getMonth(), dateObj.getDate());
  if (today < birthdayThisYear) age -= 1;
  return age;
}
function calcZodiacSign(dateObj){
  const m = dateObj.getMonth()+1, d = dateObj.getDate();
  if ((m==1 && d>=20) || (m==2 && d<=18)) return "æ°´ç“¶åº§";
  if ((m==2 && d>=19) || (m==3 && d<=20)) return "é­šåº§";
  if ((m==3 && d>=21) || (m==4 && d<=19)) return "ç‰¡ç¾Šåº§";
  if ((m==4 && d>=20) || (m==5 && d<=20)) return "ç‰¡ç‰›åº§";
  if ((m==5 && d>=21) || (m==6 && d<=21)) return "åŒå­åº§";
  if ((m==6 && d>=22) || (m==7 && d<=22)) return "èŸ¹åº§";
  if ((m==7 && d>=23) || (m==8 && d<=22)) return "ç…å­åº§";
  if ((m==8 && d>=23) || (m==9 && d<=22)) return "ä¹™å¥³åº§";
  if ((m==9 && d>=23) || (m==10 && d<=23)) return "å¤©ç§¤åº§";
  if ((m==10 && d>=24) || (m==11 && d<=22)) return "è åº§";
  if ((m==11 && d>=23) || (m==12 && d<=21)) return "å°„æ‰‹åº§";
  return "å±±ç¾Šåº§";
}

// 20ã‚¿ã‚¤ãƒ—ã‚­ãƒ¼ï¼ˆ4å±æ€§Ã—5ã‚«ãƒ†ã‚´ãƒªï¼‰
function signToElement(sign){
  const fire  = ["ç‰¡ç¾Šåº§","ç…å­åº§","å°„æ‰‹åº§"];
  const earth = ["ç‰¡ç‰›åº§","ä¹™å¥³åº§","å±±ç¾Šåº§"];
  const air   = ["åŒå­åº§","å¤©ç§¤åº§","æ°´ç“¶åº§"];
  const water = ["èŸ¹åº§","è åº§","é­šåº§"];
  if (fire.includes(sign)) return "FIRE";
  if (earth.includes(sign)) return "EARTH";
  if (air.includes(sign)) return "AIR";
  return "WATER";
}
function lifePathToBucket(lp){
  if (lp === 9) return 5;
  if (lp === 7 || lp === 8) return 4;
  if (lp === 5 || lp === 6) return 3;
  if (lp === 3 || lp === 4) return 2;
  return 1;
}
function pickTypeKey(sign, lp){
  return `${signToElement(sign)}_${lifePathToBucket(lp)}`;
}

function formatDateJP(dateObj){
  return `${dateObj.getFullYear()}/${pad2(dateObj.getMonth()+1)}/${pad2(dateObj.getDate())}`;
}
function bullets(lines){
  return lines.map(s => `ãƒ»${s}`).join("\n");
}

/* =========================================================
  æœ¬æ–‡ç”Ÿæˆï¼ˆéƒ¨å“ãƒŸãƒƒã‚¯ã‚¹æ–¹å¼ï¼‰
========================================================= */
function buildSection(sectionKey, ctx, rng, tone){
  // 1) åŸºæœ¬ãƒ—ãƒ¼ãƒ«ã‹ã‚‰æŠ½é¸
  const basePool = TEXT_DB.POOLS[sectionKey] ?? [];
  const lines = pickManyUnique(basePool, CONFIG.linesPerSection, rng);

  // 2) æ˜Ÿåº§/æ•°ç§˜/å‡ºç”Ÿæ™‚é–“ã®â€œã‚‰ã—ã•â€ã‚’æ··ãœã‚‹ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦åˆºã•ã‚Šã‚„ã™ã„ã‚‚ã®ã‚’é¸ã¶ï¼‰
  //   â€»ã“ã“ã¯å¥½ã¿ã§å¢—ã‚„ã›ã‚‹
  const signTrait = pickOne(TEXT_DB.TRAITS.signLines[ctx.sign] ?? [], rng);
  const lpTrait   = pickOne(TEXT_DB.TRAITS.lpLines[ctx.lp] ?? [], rng);
  const timeTrait = pickOne(TEXT_DB.TRAITS.timeLines[ctx.time] ?? [], rng);

  // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«æ··ãœã‚‹æ–¹é‡ï¼ˆåˆå¿ƒè€…ã§ã‚‚åˆ†ã‹ã‚‹ã‚ˆã†ã«å›ºå®šï¼‰
  if (sectionKey === "overall") {
    if (signTrait) lines.push(signTrait);
    if (lpTrait)   lines.push(lpTrait);
  }
  if (sectionKey === "work") {
    if (lpTrait)   lines.push(lpTrait);
  }
  if (sectionKey === "health") {
    if (timeTrait) lines.push(timeTrait);
  }
  if (sectionKey === "turning") {
    if (signTrait) lines.push(signTrait);
  }

  // 3) typeKeyå›ºæœ‰ã®ä¸€æ–‡ã‚’æ··ãœã‚‹ï¼ˆã‚ã‚Œã°ï¼‰
  const tLines = TEXT_DB.TYPE_LINES[ctx.typeKey];
  if (tLines && tLines.length) lines.push(pickOne(tLines, rng));

  // 4) è¡Œæ•°ãŒå¢—ãˆã™ããŸã‚‰ã€æœ€å¾Œã«æ•´å½¢ã—ã¦ã€Œã¡ã‚‡ã†ã©ã„ã„æ•°ã€ã«ã™ã‚‹
  const finalLines = pickManyUnique(lines, CONFIG.linesPerSection + 1, rng); // å°‘ã—å¤šã‚ã«ã—ã¦æ¿ƒã
  return finalLines.map(tone.wrap);
}

function buildReading({ name, place, time, dobStr, toneKey }){
  const birth = new Date(dobStr);
  const lp = calcLifePathNumber(birth);
  const sign = calcZodiacSign(birth);
  const age = calcAge(birth);

  const typeKey = pickTypeKey(sign, lp);
  const typeInfo = TEXT_DB.TYPE_20[typeKey] ?? { name:"ãªãã®ã‚¯ãƒ", desc:"ã‚¿ã‚¤ãƒ—æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¿ãŸã„ã€‚", tags:"-" };

  const signVibe = TEXT_DB.signs[sign]?.vibe ?? "";
  const lpVibe = TEXT_DB.lifepath[lp] ?? "";
  const tone = TEXT_DB.tones[toneKey] ?? TEXT_DB.tones.normal;

  // RNGï¼ˆåŒã˜å…¥åŠ›ãªã‚‰åŒã˜çµæœï¼‰
  const seedStr = `${CONFIG.deterministic ? "D" : "R"}|${name}|${dobStr}|${place}|${time}|${toneKey}|${typeKey}`;
  const rng = CONFIG.deterministic ? makeRng(hashString(seedStr)) : Math.random;

  // ç”»é¢ãƒãƒƒã‚¸
  $("badgeSign").textContent = `${sign}ï¼ˆ${signVibe}ï¼‰`;
  $("badgeLP").textContent = `${lp}ï¼ˆ${lpVibe}ï¼‰`;
  $("badgeAge").textContent = `ç¾åœ¨ï¼š${age}æ­³ç›®å®‰`;

  $("typeTitle").textContent = `ã‚¿ã‚¤ãƒ—ï¼š${typeInfo.name}`;
  $("typeDesc").textContent = typeInfo.desc;

  const metaParts = [];
  if (CONFIG.showTypeKeyInUI) metaParts.push(`typeKeyï¼š${typeKey}`);
  metaParts.push(typeInfo.tags);
  $("typeMeta").textContent = metaParts.join(" / ");

  // æœ¬æ–‡
  const ctx = { sign, lp, time, typeKey };

  const out = [];
  out.push(`# ğŸ» ã‚¯ãƒã‚¿ã‚¤ãƒ—ï¼š${typeInfo.name}`);
  out.push(typeInfo.desc);
  if (CONFIG.showTypeKeyInText) out.push(`ï¼ˆã‚¿ã‚¤ãƒ—ã‚­ãƒ¼ï¼š${typeKey}ï¼‰`);
  out.push("");

  out.push(`# ğŸ”® è©³ç´°é‘‘å®šï¼š${name || "ï¼ˆåå‰æœªå…¥åŠ›ï¼‰"}`);
  out.push("");
  out.push(`ç”Ÿå¹´æœˆæ—¥ï¼š${formatDateJP(birth)}`);
  if (CONFIG.showMeta){
    out.push(`å‡ºç”Ÿåœ°ï¼š${place || "éƒ½é“åºœçœŒ"}`);
    out.push(`å‡ºç”Ÿæ™‚é–“ï¼š${time || "ä¸æ˜"}`);
  }
  out.push(`æ˜Ÿåº§ï¼š${sign}ï¼ˆ${signVibe}ï¼‰`);
  out.push(`æ•°ç§˜ï¼š${lp}ï¼ˆ${lpVibe}ï¼‰`);
  out.push("");

  out.push(tone.header);
  out.push("");

  const titles = {
    social:"ğŸ§‘â€ğŸ¤â€ğŸ§‘ ç¤¾ä¼šã‚­ãƒ£ãƒ©",
    overall:"ğŸŒ å…¨ä½“é‹",
    work:"ğŸ’¼ ä»•äº‹é‹",
    money:"ğŸ’° é‡‘é‹",
    health:"ğŸ« å¥åº·é‹",
    love:"â¤ï¸ æ‹æ„›é‹",
    turning:"ğŸ§­ æµã‚Œã®åˆ‡ã‚Šæ›¿ã‚ã‚Š",
    final:"ğŸ•Š æœ€çµ‚è©•ä¾¡",
  };

  for (const key of CONFIG.sections){
    out.push(`## ${titles[key] || key}`);
    const lines = buildSection(key, ctx, rng, tone);
    out.push(bullets(lines));
    out.push("");
  }

  out.push(tone.footer);
  return out.join("\n");
}

/* =========================================================
  ã‚¤ãƒ™ãƒ³ãƒˆ
========================================================= */
function handleGenerate(){
  const dob = $("dob").value;
  if (!dob) return alert("ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ã­");

  $("out").value = buildReading({
    name: $("name").value,
    place: $("place").value,
    time: $("time").value,
    dobStr: dob,
    toneKey: $("tone").value
  });

  $("outputCard").scrollIntoView({ behavior:"smooth", block:"start" });
}

async function handleCopy(){
  const text = $("out").value;
  if (!text.trim()) return alert("å…ˆã«ç”Ÿæˆã—ã¦ã­");
  await navigator.clipboard.writeText(text);
  alert("ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆ");
}

function handleClear(){
  $("name").value = "";
  $("dob").value = "";
  $("place").value = "éƒ½é“åºœçœŒ";
  $("time").value = "ä¸æ˜";
  $("tone").value = "normal";

  $("badgeSign").textContent = "-";
  $("badgeLP").textContent = "-";
  $("badgeAge").textContent = "-";

  $("typeTitle").textContent = "ã‚¿ã‚¤ãƒ—ï¼š-";
  $("typeDesc").textContent = "ç”Ÿå¹´æœˆæ—¥ã‚’å…¥ã‚Œã¦ã€Œç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚";
  $("typeMeta").textContent = "-";

  $("out").value = "";
}

(function init(){
  initSelect("place", PREFECTURES);
  initSelect("time", TIME_BLOCKS);

  $("gen").addEventListener("click", handleGenerate);
  $("copy").addEventListener("click", handleCopy);
  $("clear").addEventListener("click", handleClear);
})();
</script>
</body>
</html>
